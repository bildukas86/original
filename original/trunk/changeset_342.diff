Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/serverpackets/StopRotation.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/serverpackets/StopRotation.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/serverpackets/StopRotation.java	(revision 342)
@@ -35,5 +35,5 @@
 		writeD(_degree);
 		writeD(_speed);
-		writeC(0); // ?
+		writeC(_degree);
 	}
 }
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/L2GameClient.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/L2GameClient.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/L2GameClient.java	(revision 342)
@@ -76,5 +76,5 @@
 	
 	// floodprotectors
-	private final FloodProtectors _floodProtectors = new FloodProtectors(this);
+	private final long[] _floodProtectors = new long[FloodProtectors.Action.VALUES_LENGTH];;
 	
 	// Task
@@ -163,5 +163,5 @@
 	}
 	
-	public FloodProtectors getFloodProtectors()
+	public long[] getFloodProtectors()
 	{
 		return _floodProtectors;
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/RequestBypassToServer.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/RequestBypassToServer.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/RequestBypassToServer.java	(revision 342)
@@ -33,4 +33,6 @@
 import net.sf.l2j.gameserver.network.serverpackets.ActionFailed;
 import net.sf.l2j.gameserver.network.serverpackets.NpcHtmlMessage;
+import net.sf.l2j.gameserver.util.FloodProtectors;
+import net.sf.l2j.gameserver.util.FloodProtectors.Action;
 import net.sf.l2j.gameserver.util.GMAudit;
 
@@ -48,9 +50,9 @@
 	protected void runImpl()
 	{
+		if (!FloodProtectors.performAction(getClient(), Action.SERVER_BYPASS))
+			return;
+		
 		final L2PcInstance activeChar = getClient().getActiveChar();
 		if (activeChar == null)
-			return;
-		
-		if (!getClient().getFloodProtectors().getServerBypass().tryPerformAction(_command))
 			return;
 		
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/RequestBuySeed.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/RequestBuySeed.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/RequestBuySeed.java	(revision 342)
@@ -30,10 +30,8 @@
 import net.sf.l2j.gameserver.network.serverpackets.ActionFailed;
 import net.sf.l2j.gameserver.network.serverpackets.SystemMessage;
+import net.sf.l2j.gameserver.util.FloodProtectors;
+import net.sf.l2j.gameserver.util.FloodProtectors.Action;
 import net.sf.l2j.gameserver.util.Util;
 
-/**
- * Format: cdd[dd]
- * @author l3x
- */
 public class RequestBuySeed extends L2GameClientPacket
 {
@@ -69,9 +67,9 @@
 	protected void runImpl()
 	{
-		L2PcInstance player = getClient().getActiveChar();
+		if (!FloodProtectors.performAction(getClient(), Action.MANOR))
+			return;
+		
+		final L2PcInstance player = getClient().getActiveChar();
 		if (player == null)
-			return;
-		
-		if (!getClient().getFloodProtectors().getManor().tryPerformAction("buySeed"))
 			return;
 		
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/MultiSellChoose.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/MultiSellChoose.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/MultiSellChoose.java	(revision 342)
@@ -36,4 +36,6 @@
 import net.sf.l2j.gameserver.network.serverpackets.StatusUpdate;
 import net.sf.l2j.gameserver.network.serverpackets.SystemMessage;
+import net.sf.l2j.gameserver.util.FloodProtectors;
+import net.sf.l2j.gameserver.util.FloodProtectors.Action;
 
 public class MultiSellChoose extends L2GameClientPacket
@@ -59,9 +61,9 @@
 	public void runImpl()
 	{
+		if (!FloodProtectors.performAction(getClient(), Action.MULTISELL))
+			return;
+		
 		final L2PcInstance player = getClient().getActiveChar();
 		if (player == null)
-			return;
-		
-		if (!getClient().getFloodProtectors().getMultiSell().tryPerformAction("multisellChoose"))
 			return;
 		
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/CharacterSelected.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/CharacterSelected.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/CharacterSelected.java	(revision 342)
@@ -23,8 +23,9 @@
 import net.sf.l2j.gameserver.network.serverpackets.CharSelected;
 import net.sf.l2j.gameserver.network.serverpackets.SignsSky;
+import net.sf.l2j.gameserver.util.FloodProtectors;
+import net.sf.l2j.gameserver.util.FloodProtectors.Action;
 
 public class CharacterSelected extends L2GameClientPacket
 {
-	// cd
 	private int _charSlot;
 	
@@ -52,5 +53,5 @@
 	{
 		final L2GameClient client = getClient();
-		if (!client.getFloodProtectors().getCharacterSelect().tryPerformAction("characterSelect"))
+		if (!FloodProtectors.performAction(client, Action.CHARACTER_SELECT))
 			return;
 		
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/RequestSocialAction.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/RequestSocialAction.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/RequestSocialAction.java	(revision 342)
@@ -20,4 +20,6 @@
 import net.sf.l2j.gameserver.network.SystemMessageId;
 import net.sf.l2j.gameserver.network.serverpackets.SocialAction;
+import net.sf.l2j.gameserver.util.FloodProtectors;
+import net.sf.l2j.gameserver.util.FloodProtectors.Action;
 import net.sf.l2j.gameserver.util.Util;
 
@@ -35,9 +37,11 @@
 	protected void runImpl()
 	{
+		if (!FloodProtectors.performAction(getClient(), Action.SOCIAL))
+			return;
+		
 		final L2PcInstance activeChar = getClient().getActiveChar();
 		if (activeChar == null)
 			return;
 		
-		// You cannot do anything while fishing
 		if (activeChar.isFishing())
 		{
@@ -46,5 +50,4 @@
 		}
 		
-		// check if the actionId is allowed
 		if (_actionId < 2 || _actionId > 13)
 		{
@@ -53,11 +56,8 @@
 		}
 		
-		if (!activeChar.isInStoreMode() && activeChar.getActiveRequester() == null && !activeChar.isAlikeDead() && (!activeChar.isAllSkillsDisabled() || activeChar.isInDuel()) && activeChar.getAI().getIntention() == CtrlIntention.IDLE)
-		{
-			if (Config.DEBUG)
-				_log.fine("Social Action: " + _actionId);
-			
-			activeChar.broadcastPacket(new SocialAction(activeChar, _actionId));
-		}
+		if (activeChar.isInStoreMode() || activeChar.getActiveRequester() != null || activeChar.isAlikeDead() || activeChar.getAI().getIntention() != CtrlIntention.IDLE)
+			return;
+		
+		activeChar.broadcastPacket(new SocialAction(activeChar, _actionId));
 	}
 }
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/RequestBuyProcure.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/RequestBuyProcure.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/RequestBuyProcure.java	(revision 342)
@@ -31,4 +31,6 @@
 import net.sf.l2j.gameserver.network.serverpackets.StatusUpdate;
 import net.sf.l2j.gameserver.network.serverpackets.SystemMessage;
+import net.sf.l2j.gameserver.util.FloodProtectors;
+import net.sf.l2j.gameserver.util.FloodProtectors.Action;
 
 public class RequestBuyProcure extends L2GameClientPacket
@@ -67,9 +69,9 @@
 	protected void runImpl()
 	{
-		L2PcInstance player = getClient().getActiveChar();
-		if (player == null)
+		if (!FloodProtectors.performAction(getClient(), Action.MANOR))
 			return;
 		
-		if (!getClient().getFloodProtectors().getManor().tryPerformAction("buyProcure"))
+		final L2PcInstance player = getClient().getActiveChar();
+		if (player == null)
 			return;
 		
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/MoveBackwardToLocation.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/MoveBackwardToLocation.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/MoveBackwardToLocation.java	(revision 342)
@@ -29,5 +29,4 @@
 public class MoveBackwardToLocation extends L2GameClientPacket
 {
-	// cdddddd
 	private int _targetX;
 	private int _targetY;
@@ -36,4 +35,6 @@
 	private int _originY;
 	private int _originZ;
+	
+	@SuppressWarnings("unused")
 	private int _moveMovement;
 	
@@ -69,5 +70,5 @@
 			return;
 		
-		if (activeChar.isOutOfControl() || (_moveMovement == 0 && Config.GEODATA < 1)) // cursor movement without geodata is disabled
+		if (activeChar.isOutOfControl())
 		{
 			activeChar.sendPacket(ActionFailed.STATIC_PACKET);
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/CharacterDelete.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/CharacterDelete.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/CharacterDelete.java	(revision 342)
@@ -17,12 +17,12 @@
 import java.util.logging.Level;
 
-import net.sf.l2j.Config;
 import net.sf.l2j.gameserver.network.serverpackets.CharDeleteFail;
 import net.sf.l2j.gameserver.network.serverpackets.CharDeleteOk;
 import net.sf.l2j.gameserver.network.serverpackets.CharSelectInfo;
+import net.sf.l2j.gameserver.util.FloodProtectors;
+import net.sf.l2j.gameserver.util.FloodProtectors.Action;
 
 public final class CharacterDelete extends L2GameClientPacket
 {
-	// cd
 	private int _charSlot;
 	
@@ -36,12 +36,9 @@
 	protected void runImpl()
 	{
-		if (!getClient().getFloodProtectors().getCharacterSelect().tryPerformAction("characterDelete"))
+		if (!FloodProtectors.performAction(getClient(), Action.CHARACTER_SELECT))
 		{
 			sendPacket(new CharDeleteFail(CharDeleteFail.REASON_DELETION_FAILED));
 			return;
 		}
-		
-		if (Config.DEBUG)
-			_log.fine("deleting slot:" + _charSlot);
 		
 		try
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/RequestDropItem.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/RequestDropItem.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/RequestDropItem.java	(revision 342)
@@ -22,4 +22,6 @@
 import net.sf.l2j.gameserver.network.serverpackets.InventoryUpdate;
 import net.sf.l2j.gameserver.network.serverpackets.ItemList;
+import net.sf.l2j.gameserver.util.FloodProtectors;
+import net.sf.l2j.gameserver.util.FloodProtectors.Action;
 import net.sf.l2j.gameserver.util.IllegalPlayerAction;
 import net.sf.l2j.gameserver.util.Util;
@@ -46,9 +48,9 @@
 	protected void runImpl()
 	{
+		if (!FloodProtectors.performAction(getClient(), Action.DROP_ITEM))
+			return;
+		
 		final L2PcInstance activeChar = getClient().getActiveChar();
 		if (activeChar == null || activeChar.isDead())
-			return;
-		
-		if (!getClient().getFloodProtectors().getDropItem().tryPerformAction("dropItem"))
 			return;
 		
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/RequestRecipeItemMakeSelf.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/RequestRecipeItemMakeSelf.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/RequestRecipeItemMakeSelf.java	(revision 342)
@@ -17,8 +17,7 @@
 import net.sf.l2j.gameserver.datatables.RecipeTable;
 import net.sf.l2j.gameserver.model.actor.instance.L2PcInstance;
+import net.sf.l2j.gameserver.util.FloodProtectors;
+import net.sf.l2j.gameserver.util.FloodProtectors.Action;
 
-/**
- * @author Administrator
- */
 public final class RequestRecipeItemMakeSelf extends L2GameClientPacket
 {
@@ -34,5 +33,5 @@
 	protected void runImpl()
 	{
-		if (!getClient().getFloodProtectors().getManufacture().tryPerformAction("makeSelf"))
+		if (!FloodProtectors.performAction(getClient(), Action.MANUFACTURE))
 			return;
 		
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/CharacterRestore.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/CharacterRestore.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/CharacterRestore.java	(revision 342)
@@ -16,8 +16,9 @@
 
 import net.sf.l2j.gameserver.network.serverpackets.CharSelectInfo;
+import net.sf.l2j.gameserver.util.FloodProtectors;
+import net.sf.l2j.gameserver.util.FloodProtectors.Action;
 
 public final class CharacterRestore extends L2GameClientPacket
 {
-	// cd
 	private int _charSlot;
 	
@@ -31,5 +32,5 @@
 	protected void runImpl()
 	{
-		if (!getClient().getFloodProtectors().getCharacterSelect().tryPerformAction("characterRestore"))
+		if (!FloodProtectors.performAction(getClient(), Action.CHARACTER_SELECT))
 			return;
 		
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/RequestRecipeShopMakeItem.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/RequestRecipeShopMakeItem.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/network/clientpackets/RequestRecipeShopMakeItem.java	(revision 342)
@@ -19,9 +19,8 @@
 import net.sf.l2j.gameserver.model.actor.instance.L2PcInstance;
 import net.sf.l2j.gameserver.network.SystemMessageId;
+import net.sf.l2j.gameserver.util.FloodProtectors;
 import net.sf.l2j.gameserver.util.Util;
+import net.sf.l2j.gameserver.util.FloodProtectors.Action;
 
-/**
- * @author Administrator
- */
 public final class RequestRecipeShopMakeItem extends L2GameClientPacket
 {
@@ -42,5 +41,5 @@
 	protected void runImpl()
 	{
-		if (!getClient().getFloodProtectors().getManufacture().tryPerformAction("shopMake"))
+		if (!FloodProtectors.performAction(getClient(), Action.MANUFACTURE))
 			return;
 		
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/taskmanager/MovementTaskManager.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/taskmanager/MovementTaskManager.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/taskmanager/MovementTaskManager.java	(revision 342)
@@ -58,5 +58,5 @@
 	public final void add(final L2Character cha)
 	{
-		_characters.put(cha.getObjectId(), cha);
+		_characters.putIfAbsent(cha.getObjectId(), cha);
 	}
 	
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/model/actor/instance/L2VillageMasterInstance.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/model/actor/instance/L2VillageMasterInstance.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/model/actor/instance/L2VillageMasterInstance.java	(revision 342)
@@ -44,4 +44,6 @@
 import net.sf.l2j.gameserver.network.serverpackets.SystemMessage;
 import net.sf.l2j.gameserver.network.serverpackets.UserInfo;
+import net.sf.l2j.gameserver.util.FloodProtectors;
+import net.sf.l2j.gameserver.util.FloodProtectors.Action;
 import net.sf.l2j.gameserver.util.Util;
 import net.sf.l2j.util.StringUtil;
@@ -324,5 +326,5 @@
 					break;
 				case 4: // Add Subclass - Action (Subclass 4 x[x])
-					if (!player.getFloodProtectors().getSubclass().tryPerformAction("addSubclass"))
+					if (!FloodProtectors.performAction(player.getClient(), Action.SUBCLASS))
 						return;
 					
@@ -373,5 +375,5 @@
 					break;
 				case 5: // Change Class - Action
-					if (!player.getFloodProtectors().getSubclass().tryPerformAction("changeSubclass"))
+					if (!FloodProtectors.performAction(player.getClient(), Action.SUBCLASS))
 						return;
 					
@@ -439,5 +441,5 @@
 					break;
 				case 7: // Change Subclass - Action
-					if (!player.getFloodProtectors().getSubclass().tryPerformAction("changeSubclass"))
+					if (!FloodProtectors.performAction(player.getClient(), Action.SUBCLASS))
 						return;
 					
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/model/actor/instance/L2PcInstance.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/model/actor/instance/L2PcInstance.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/model/actor/instance/L2PcInstance.java	(revision 342)
@@ -243,5 +243,4 @@
 import net.sf.l2j.gameserver.templates.skills.L2SkillType;
 import net.sf.l2j.gameserver.util.Broadcast;
-import net.sf.l2j.gameserver.util.FloodProtectors;
 import net.sf.l2j.gameserver.util.Util;
 import net.sf.l2j.util.Rnd;
@@ -10108,9 +10107,4 @@
 	}
 	
-	public FloodProtectors getFloodProtectors()
-	{
-		return getClient().getFloodProtectors();
-	}
-	
 	/**
 	 * Remove player from BossZones (used on char logout/exit)
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/itemhandlers/RollingDice.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/itemhandlers/RollingDice.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/itemhandlers/RollingDice.java	(revision 342)
@@ -19,9 +19,10 @@
 import net.sf.l2j.gameserver.model.actor.instance.L2PcInstance;
 import net.sf.l2j.gameserver.model.item.instance.ItemInstance;
-import net.sf.l2j.gameserver.model.zone.ZoneId;
 import net.sf.l2j.gameserver.network.SystemMessageId;
 import net.sf.l2j.gameserver.network.serverpackets.Dice;
 import net.sf.l2j.gameserver.network.serverpackets.SystemMessage;
 import net.sf.l2j.gameserver.util.Broadcast;
+import net.sf.l2j.gameserver.util.FloodProtectors;
+import net.sf.l2j.gameserver.util.FloodProtectors.Action;
 import net.sf.l2j.util.Rnd;
 
@@ -34,36 +35,16 @@
 			return;
 		
-		L2PcInstance activeChar = (L2PcInstance) playable;
-		int itemId = item.getItemId();
+		final L2PcInstance activeChar = (L2PcInstance) playable;
 		
-		if (itemId == 4625 || itemId == 4626 || itemId == 4627 || itemId == 4628)
+		if (!FloodProtectors.performAction(activeChar.getClient(), Action.ROLL_DICE))
 		{
-			int number = rollDice(activeChar);
-			if (number == 0)
-			{
-				activeChar.sendPacket(SystemMessageId.YOU_MAY_NOT_THROW_THE_DICE_AT_THIS_TIME_TRY_AGAIN_LATER);
-				return;
-			}
-			
-			Broadcast.toSelfAndKnownPlayers(activeChar, new Dice(activeChar.getObjectId(), item.getItemId(), number, activeChar.getX() - 30, activeChar.getY() - 30, activeChar.getZ()));
-			
-			SystemMessage sm = SystemMessage.getSystemMessage(SystemMessageId.S1_ROLLED_S2);
-			sm.addPcName(activeChar);
-			sm.addNumber(number);
-			
-			activeChar.sendPacket(sm);
-			if (activeChar.isInsideZone(ZoneId.PEACE))
-				Broadcast.toKnownPlayers(activeChar, sm);
-			else if (activeChar.isInParty())
-				activeChar.getParty().broadcastToPartyMembers(activeChar, sm);
+			activeChar.sendPacket(SystemMessageId.YOU_MAY_NOT_THROW_THE_DICE_AT_THIS_TIME_TRY_AGAIN_LATER);
+			return;
 		}
-	}
-	
-	private static int rollDice(L2PcInstance player)
-	{
-		if (!player.getFloodProtectors().getRollDice().tryPerformAction("rollDice"))
-			return 0;
 		
-		return Rnd.get(1, 6);
+		final int number = Rnd.get(1, 6);
+		
+		Broadcast.toSelfAndKnownPlayers(activeChar, new Dice(activeChar.getObjectId(), item.getItemId(), number, activeChar.getX() - 30, activeChar.getY() - 30, activeChar.getZ()));
+		Broadcast.toSelfAndKnownPlayers(activeChar, SystemMessage.getSystemMessage(SystemMessageId.S1_ROLLED_S2).addPcName(activeChar).addNumber(number));
 	}
 }
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatParty.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatParty.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatParty.java	(revision 342)
@@ -19,8 +19,4 @@
 import net.sf.l2j.gameserver.network.serverpackets.CreatureSay;
 
-/**
- * A chat handler
- * @author durgus
- */
 public class ChatParty implements IChatHandler
 {
@@ -30,23 +26,13 @@
 	};
 	
-	/**
-	 * Handle chat type 'party'
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#handleChat(int, net.sf.l2j.gameserver.model.actor.instance.L2PcInstance, java.lang.String, java.lang.String)
-	 */
 	@Override
 	public void handleChat(int type, L2PcInstance activeChar, String target, String text)
 	{
-		if (activeChar.isInParty())
-		{
-			CreatureSay cs = new CreatureSay(activeChar.getObjectId(), type, activeChar.getName(), text);
-			
-			activeChar.getParty().broadcastToPartyMembers(cs);
-		}
+		if (!activeChar.isInParty())
+			return;
+		
+		activeChar.getParty().broadcastToPartyMembers(new CreatureSay(activeChar.getObjectId(), type, activeChar.getName(), text));
 	}
 	
-	/**
-	 * Returns the chat types registered to this handler
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#getChatTypeList()
-	 */
 	@Override
 	public int[] getChatTypeList()
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatTrade.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatTrade.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatTrade.java	(revision 342)
@@ -15,6 +15,4 @@
 package net.sf.l2j.gameserver.handler.chathandlers;
 
-import java.util.Collection;
-
 import net.sf.l2j.gameserver.datatables.MapRegionTable;
 import net.sf.l2j.gameserver.handler.IChatHandler;
@@ -23,9 +21,7 @@
 import net.sf.l2j.gameserver.model.actor.instance.L2PcInstance;
 import net.sf.l2j.gameserver.network.serverpackets.CreatureSay;
+import net.sf.l2j.gameserver.util.FloodProtectors;
+import net.sf.l2j.gameserver.util.FloodProtectors.Action;
 
-/**
- * A chat handler
- * @author durgus
- */
 public class ChatTrade implements IChatHandler
 {
@@ -35,27 +31,20 @@
 	};
 	
-	/**
-	 * Handle chat type 'trade'
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#handleChat(int, net.sf.l2j.gameserver.model.actor.instance.L2PcInstance, java.lang.String, java.lang.String)
-	 */
 	@Override
 	public void handleChat(int type, L2PcInstance activeChar, String target, String text)
 	{
-		CreatureSay cs = new CreatureSay(activeChar.getObjectId(), type, activeChar.getName(), text);
-		Collection<L2PcInstance> pls = L2World.getInstance().getAllPlayers().values();
-		int region = MapRegionTable.getMapRegion(activeChar.getX(), activeChar.getY());
+		if (!FloodProtectors.performAction(activeChar.getClient(), Action.TRADE_CHAT))
+			return;
 		
-		for (L2PcInstance player : pls)
+		final CreatureSay cs = new CreatureSay(activeChar.getObjectId(), type, activeChar.getName(), text);
+		final int region = MapRegionTable.getMapRegion(activeChar.getX(), activeChar.getY());
+		
+		for (L2PcInstance player : L2World.getInstance().getAllPlayers().values())
 		{
-			if (!BlockList.isBlocked(player, activeChar))
-				if (region == MapRegionTable.getMapRegion(player.getX(), player.getY()))
-					player.sendPacket(cs);
+			if (!BlockList.isBlocked(player, activeChar) && region == MapRegionTable.getMapRegion(player.getX(), player.getY()))
+				player.sendPacket(cs);
 		}
 	}
 	
-	/**
-	 * Returns the chat types registered to this handler
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#getChatTypeList()
-	 */
 	@Override
 	public int[] getChatTypeList()
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatTell.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatTell.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatTell.java	(revision 342)
@@ -22,8 +22,4 @@
 import net.sf.l2j.gameserver.network.serverpackets.CreatureSay;
 
-/**
- * A chat handler
- * @author durgus
- */
 public class ChatTell implements IChatHandler
 {
@@ -33,53 +29,39 @@
 	};
 	
-	/**
-	 * Handle chat type 'tell'
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#handleChat(int, net.sf.l2j.gameserver.model.actor.instance.L2PcInstance, java.lang.String, java.lang.String)
-	 */
 	@Override
 	public void handleChat(int type, L2PcInstance activeChar, String target, String text)
 	{
-		// Return if no target is set.
 		if (target == null)
 			return;
 		
 		final L2PcInstance receiver = L2World.getInstance().getPlayer(target);
-		if (receiver != null)
+		if (receiver == null || receiver.getClient().isDetached())
 		{
-			if (activeChar.equals(receiver))
-			{
-				activeChar.sendPacket(SystemMessageId.INCORRECT_TARGET);
-				return;
-			}
-			
-			if (receiver.isInJail() || receiver.isChatBanned())
-			{
-				activeChar.sendPacket(SystemMessageId.TARGET_IS_CHAT_BANNED);
-				return;
-			}
-			
-			if (receiver.getClient().isDetached())
-			{
-				activeChar.sendPacket(SystemMessageId.TARGET_IS_NOT_FOUND_IN_THE_GAME);
-				return;
-			}
-			
-			if (!activeChar.isGM() && (receiver.isInRefusalMode() || BlockList.isBlocked(receiver, activeChar)))
-			{
-				activeChar.sendPacket(SystemMessageId.THE_PERSON_IS_IN_MESSAGE_REFUSAL_MODE);
-				return;
-			}
-			
-			receiver.sendPacket(new CreatureSay(activeChar.getObjectId(), type, activeChar.getName(), text));
-			activeChar.sendPacket(new CreatureSay(activeChar.getObjectId(), type, "->" + receiver.getName(), text));
+			activeChar.sendPacket(SystemMessageId.TARGET_IS_NOT_FOUND_IN_THE_GAME);
+			return;
 		}
-		else
-			activeChar.sendPacket(SystemMessageId.TARGET_IS_NOT_FOUND_IN_THE_GAME);
+		
+		if (activeChar.equals(receiver))
+		{
+			activeChar.sendPacket(SystemMessageId.INCORRECT_TARGET);
+			return;
+		}
+		
+		if (receiver.isInJail() || receiver.isChatBanned())
+		{
+			activeChar.sendPacket(SystemMessageId.TARGET_IS_CHAT_BANNED);
+			return;
+		}
+		
+		if (!activeChar.isGM() && (receiver.isInRefusalMode() || BlockList.isBlocked(receiver, activeChar)))
+		{
+			activeChar.sendPacket(SystemMessageId.THE_PERSON_IS_IN_MESSAGE_REFUSAL_MODE);
+			return;
+		}
+		
+		receiver.sendPacket(new CreatureSay(activeChar.getObjectId(), type, activeChar.getName(), text));
+		activeChar.sendPacket(new CreatureSay(activeChar.getObjectId(), type, "->" + receiver.getName(), text));
 	}
 	
-	/**
-	 * Returns the chat types registered to this handler
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#getChatTypeList()
-	 */
 	@Override
 	public int[] getChatTypeList()
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatPartyRoomCommander.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatPartyRoomCommander.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatPartyRoomCommander.java	(revision 342)
@@ -19,8 +19,4 @@
 import net.sf.l2j.gameserver.network.serverpackets.CreatureSay;
 
-/**
- * A chat handler
- * @author durgus
- */
 public class ChatPartyRoomCommander implements IChatHandler
 {
@@ -30,25 +26,13 @@
 	};
 	
-	/**
-	 * Handle chat type 'party room commander'
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#handleChat(int, net.sf.l2j.gameserver.model.actor.instance.L2PcInstance, java.lang.String, java.lang.String)
-	 */
 	@Override
 	public void handleChat(int type, L2PcInstance activeChar, String target, String text)
 	{
-		if (activeChar.isInParty())
-		{
-			if (activeChar.getParty().isInCommandChannel() && activeChar.getParty().getCommandChannel().getChannelLeader().equals(activeChar))
-			{
-				CreatureSay cs = new CreatureSay(activeChar.getObjectId(), type, activeChar.getName(), text);
-				activeChar.getParty().getCommandChannel().broadcastCSToChannelMembers(cs, activeChar);
-			}
-		}
+		if (!activeChar.isInParty() || !activeChar.getParty().isInCommandChannel() || !activeChar.getParty().getCommandChannel().getChannelLeader().equals(activeChar))
+			return;
+		
+		activeChar.getParty().getCommandChannel().broadcastCSToChannelMembers(new CreatureSay(activeChar.getObjectId(), type, activeChar.getName(), text), activeChar);
 	}
 	
-	/**
-	 * Returns the chat types registered to this handler
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#getChatTypeList()
-	 */
 	@Override
 	public int[] getChatTypeList()
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatShout.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatShout.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatShout.java	(revision 342)
@@ -15,6 +15,4 @@
 package net.sf.l2j.gameserver.handler.chathandlers;
 
-import java.util.Collection;
-
 import net.sf.l2j.gameserver.datatables.MapRegionTable;
 import net.sf.l2j.gameserver.handler.IChatHandler;
@@ -23,9 +21,7 @@
 import net.sf.l2j.gameserver.model.actor.instance.L2PcInstance;
 import net.sf.l2j.gameserver.network.serverpackets.CreatureSay;
+import net.sf.l2j.gameserver.util.FloodProtectors;
+import net.sf.l2j.gameserver.util.FloodProtectors.Action;
 
-/**
- * A chat handler
- * @author durgus
- */
 public class ChatShout implements IChatHandler
 {
@@ -35,27 +31,20 @@
 	};
 	
-	/**
-	 * Handle chat type 'shout'
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#handleChat(int, net.sf.l2j.gameserver.model.actor.instance.L2PcInstance, java.lang.String, java.lang.String)
-	 */
 	@Override
 	public void handleChat(int type, L2PcInstance activeChar, String target, String text)
 	{
-		CreatureSay cs = new CreatureSay(activeChar.getObjectId(), type, activeChar.getName(), text);
-		Collection<L2PcInstance> pls = L2World.getInstance().getAllPlayers().values();
-		int region = MapRegionTable.getMapRegion(activeChar.getX(), activeChar.getY());
+		if (!FloodProtectors.performAction(activeChar.getClient(), Action.GLOBAL_CHAT))
+			return;
 		
-		for (L2PcInstance player : pls)
+		final CreatureSay cs = new CreatureSay(activeChar.getObjectId(), type, activeChar.getName(), text);
+		final int region = MapRegionTable.getMapRegion(activeChar.getX(), activeChar.getY());
+		
+		for (L2PcInstance player : L2World.getInstance().getAllPlayers().values())
 		{
-			if (!BlockList.isBlocked(player, activeChar))
-				if (region == MapRegionTable.getMapRegion(player.getX(), player.getY()))
-					player.sendPacket(cs);
+			if (!BlockList.isBlocked(player, activeChar) && region == MapRegionTable.getMapRegion(player.getX(), player.getY()))
+				player.sendPacket(cs);
 		}
 	}
 	
-	/**
-	 * Returns the chat types registered to this handler
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#getChatTypeList()
-	 */
 	@Override
 	public int[] getChatTypeList()
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatHeroVoice.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatHeroVoice.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatHeroVoice.java	(revision 342)
@@ -15,15 +15,11 @@
 package net.sf.l2j.gameserver.handler.chathandlers;
 
-import java.util.Collection;
-
 import net.sf.l2j.gameserver.handler.IChatHandler;
 import net.sf.l2j.gameserver.model.L2World;
 import net.sf.l2j.gameserver.model.actor.instance.L2PcInstance;
 import net.sf.l2j.gameserver.network.serverpackets.CreatureSay;
+import net.sf.l2j.gameserver.util.FloodProtectors;
+import net.sf.l2j.gameserver.util.FloodProtectors.Action;
 
-/**
- * A chat handler
- * @author durgus
- */
 public class ChatHeroVoice implements IChatHandler
 {
@@ -33,28 +29,18 @@
 	};
 	
-	/**
-	 * Handle chat type 'hero voice'
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#handleChat(int, net.sf.l2j.gameserver.model.actor.instance.L2PcInstance, java.lang.String, java.lang.String)
-	 */
 	@Override
 	public void handleChat(int type, L2PcInstance activeChar, String target, String text)
 	{
-		if (activeChar.isHero())
-		{
-			if (!activeChar.getFloodProtectors().getHeroVoice().tryPerformAction("heroVoice"))
-				return;
-			
-			CreatureSay cs = new CreatureSay(activeChar.getObjectId(), type, activeChar.getName(), text);
-			
-			Collection<L2PcInstance> pls = L2World.getInstance().getAllPlayers().values();
-			for (L2PcInstance player : pls)
-				player.sendPacket(cs);
-		}
+		if (!activeChar.isHero())
+			return;
+		
+		if (!FloodProtectors.performAction(activeChar.getClient(), Action.HERO_VOICE))
+			return;
+		
+		final CreatureSay cs = new CreatureSay(activeChar.getObjectId(), type, activeChar.getName(), text);
+		for (L2PcInstance player : L2World.getInstance().getAllPlayers().values())
+			player.sendPacket(cs);
 	}
 	
-	/**
-	 * Returns the chat types registered to this handler
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#getChatTypeList()
-	 */
 	@Override
 	public int[] getChatTypeList()
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatPartyRoomAll.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatPartyRoomAll.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatPartyRoomAll.java	(revision 342)
@@ -19,8 +19,4 @@
 import net.sf.l2j.gameserver.network.serverpackets.CreatureSay;
 
-/**
- * A chat handler
- * @author durgus
- */
 public class ChatPartyRoomAll implements IChatHandler
 {
@@ -30,25 +26,13 @@
 	};
 	
-	/**
-	 * Handle chat type 'party room all'
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#handleChat(int, net.sf.l2j.gameserver.model.actor.instance.L2PcInstance, java.lang.String, java.lang.String)
-	 */
 	@Override
 	public void handleChat(int type, L2PcInstance activeChar, String target, String text)
 	{
-		if (activeChar.isInParty())
-		{
-			if (activeChar.getParty().isInCommandChannel() && activeChar.getParty().isLeader(activeChar))
-			{
-				CreatureSay cs = new CreatureSay(activeChar.getObjectId(), type, activeChar.getName(), text);
-				activeChar.getParty().getCommandChannel().broadcastCSToChannelMembers(cs, activeChar);
-			}
-		}
+		if (!activeChar.isInParty() || !activeChar.getParty().isInCommandChannel() || !activeChar.getParty().isLeader(activeChar))
+			return;
+		
+		activeChar.getParty().getCommandChannel().broadcastCSToChannelMembers(new CreatureSay(activeChar.getObjectId(), type, activeChar.getName(), text), activeChar);
 	}
 	
-	/**
-	 * Returns the chat types registered to this handler
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#getChatTypeList()
-	 */
 	@Override
 	public int[] getChatTypeList()
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatAll.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatAll.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatAll.java	(revision 342)
@@ -19,9 +19,7 @@
 import net.sf.l2j.gameserver.model.actor.instance.L2PcInstance;
 import net.sf.l2j.gameserver.network.serverpackets.CreatureSay;
+import net.sf.l2j.gameserver.util.FloodProtectors;
+import net.sf.l2j.gameserver.util.FloodProtectors.Action;
 
-/**
- * A chat handler
- * @author durgus
- */
 public class ChatAll implements IChatHandler
 {
@@ -31,13 +29,11 @@
 	};
 	
-	/**
-	 * Handle chat type 'all'
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#handleChat(int, net.sf.l2j.gameserver.model.actor.instance.L2PcInstance, java.lang.String, java.lang.String)
-	 */
 	@Override
 	public void handleChat(int type, L2PcInstance activeChar, String params, String text)
 	{
-		CreatureSay cs = new CreatureSay(activeChar.getObjectId(), type, activeChar.getName(), text);
+		if (!FloodProtectors.performAction(activeChar.getClient(), Action.GLOBAL_CHAT))
+			return;
 		
+		final CreatureSay cs = new CreatureSay(activeChar.getObjectId(), type, activeChar.getName(), text);
 		for (L2PcInstance player : activeChar.getKnownList().getKnownTypeInRadius(L2PcInstance.class, 1250))
 		{
@@ -45,12 +41,7 @@
 				player.sendPacket(cs);
 		}
-		
 		activeChar.sendPacket(cs);
 	}
 	
-	/**
-	 * Returns the chat types registered to this handler
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#getChatTypeList()
-	 */
 	@Override
 	public int[] getChatTypeList()
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatAlliance.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatAlliance.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatAlliance.java	(revision 342)
@@ -26,22 +26,13 @@
 	};
 	
-	/**
-	 * Handle chat type 'alliance'
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#handleChat(int, net.sf.l2j.gameserver.model.actor.instance.L2PcInstance, java.lang.String, java.lang.String)
-	 */
 	@Override
 	public void handleChat(int type, L2PcInstance activeChar, String target, String text)
 	{
-		if (activeChar.getClan() != null)
-		{
-			CreatureSay cs = new CreatureSay(activeChar.getObjectId(), type, activeChar.getName(), text);
-			activeChar.getClan().broadcastToOnlineAllyMembers(cs);
-		}
+		if (activeChar.getClan() == null)
+			return;
+		
+		activeChar.getClan().broadcastToOnlineAllyMembers(new CreatureSay(activeChar.getObjectId(), type, activeChar.getName(), text));
 	}
 	
-	/**
-	 * Returns the chat types registered to this handler
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#getChatTypeList()
-	 */
 	@Override
 	public int[] getChatTypeList()
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatPartyMatchRoom.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatPartyMatchRoom.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatPartyMatchRoom.java	(revision 342)
@@ -21,8 +21,4 @@
 import net.sf.l2j.gameserver.network.serverpackets.CreatureSay;
 
-/**
- * A chat handler
- * @author Gnacik
- */
 public class ChatPartyMatchRoom implements IChatHandler
 {
@@ -32,27 +28,19 @@
 	};
 	
-	/**
-	 * Handle chat type 'PartyMatchRoom'
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#handleChat(int, net.sf.l2j.gameserver.model.actor.instance.L2PcInstance, java.lang.String, java.lang.String)
-	 */
 	@Override
 	public void handleChat(int type, L2PcInstance activeChar, String target, String text)
 	{
-		if (activeChar.isInPartyMatchRoom())
-		{
-			PartyMatchRoom _room = PartyMatchRoomList.getInstance().getPlayerRoom(activeChar);
-			if (_room != null)
-			{
-				CreatureSay cs = new CreatureSay(activeChar.getObjectId(), type, activeChar.getName(), text);
-				for (L2PcInstance _member : _room.getPartyMembers())
-					_member.sendPacket(cs);
-			}
-		}
+		if (!activeChar.isInPartyMatchRoom())
+			return;
+		
+		final PartyMatchRoom room = PartyMatchRoomList.getInstance().getPlayerRoom(activeChar);
+		if (room == null)
+			return;
+		
+		final CreatureSay cs = new CreatureSay(activeChar.getObjectId(), type, activeChar.getName(), text);
+		for (L2PcInstance member : room.getPartyMembers())
+			member.sendPacket(cs);
 	}
 	
-	/**
-	 * Returns the chat types registered to this handler
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#getChatTypeList()
-	 */
 	@Override
 	public int[] getChatTypeList()
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatPetition.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatPetition.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatPetition.java	(revision 342)
@@ -20,8 +20,4 @@
 import net.sf.l2j.gameserver.network.SystemMessageId;
 
-/**
- * A chat handler
- * @author durgus
- */
 public class ChatPetition implements IChatHandler
 {
@@ -32,8 +28,4 @@
 	};
 	
-	/**
-	 * Handle chat type 'petition player'
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#handleChat(int, net.sf.l2j.gameserver.model.actor.instance.L2PcInstance, java.lang.String, java.lang.String)
-	 */
 	@Override
 	public void handleChat(int type, L2PcInstance activeChar, String target, String text)
@@ -48,8 +40,4 @@
 	}
 	
-	/**
-	 * Returns the chat types registered to this handler
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#getChatTypeList()
-	 */
 	@Override
 	public int[] getChatTypeList()
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatClan.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatClan.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/chathandlers/ChatClan.java	(revision 342)
@@ -19,8 +19,4 @@
 import net.sf.l2j.gameserver.network.serverpackets.CreatureSay;
 
-/**
- * A chat handler
- * @author durgus
- */
 public class ChatClan implements IChatHandler
 {
@@ -30,22 +26,13 @@
 	};
 	
-	/**
-	 * Handle chat type 'clan'
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#handleChat(int, net.sf.l2j.gameserver.model.actor.instance.L2PcInstance, java.lang.String, java.lang.String)
-	 */
 	@Override
 	public void handleChat(int type, L2PcInstance activeChar, String target, String text)
 	{
-		if (activeChar.getClan() != null)
-		{
-			CreatureSay cs = new CreatureSay(activeChar.getObjectId(), type, activeChar.getName(), text);
-			activeChar.getClan().broadcastToOnlineMembers(cs);
-		}
+		if (activeChar.getClan() == null)
+			return;
+		
+		activeChar.getClan().broadcastToOnlineMembers(new CreatureSay(activeChar.getObjectId(), type, activeChar.getName(), text));
 	}
 	
-	/**
-	 * Returns the chat types registered to this handler
-	 * @see net.sf.l2j.gameserver.handler.IChatHandler#getChatTypeList()
-	 */
 	@Override
 	public int[] getChatTypeList()
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/admincommandhandlers/AdminAnnouncements.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/admincommandhandlers/AdminAnnouncements.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/handler/admincommandhandlers/AdminAnnouncements.java	(revision 342)
@@ -55,5 +55,5 @@
 					AnnouncementTable.getInstance().listAnnouncements(activeChar);
 					break;
-					
+				
 				case "all_auto":
 					for (L2PcInstance player : L2World.getInstance().getAllPlayers().values())
@@ -62,5 +62,5 @@
 					AnnouncementTable.getInstance().listAnnouncements(activeChar);
 					break;
-					
+				
 				case "add":
 					try
Index: /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/util/FloodProtectors.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/util/FloodProtectors.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/util/FloodProtectors.java	(revision 342)
@@ -16,88 +16,59 @@
 import net.sf.l2j.gameserver.network.L2GameClient;
 
-/**
- * Collection of flood protectors for single player.
- * @author fordfrog
- */
 public final class FloodProtectors
 {
-	private final FloodProtectorAction _rollDice;
-	private final FloodProtectorAction _heroVoice;
-	private final FloodProtectorAction _subclass;
-	private final FloodProtectorAction _dropItem;
-	private final FloodProtectorAction _serverBypass;
-	private final FloodProtectorAction _multiSell;
-	private final FloodProtectorAction _manufacture;
-	private final FloodProtectorAction _manor;
-	private final FloodProtectorAction _sendMail;
-	private final FloodProtectorAction _characterSelect;
+	public static enum Action
+	{
+		ROLL_DICE(Config.ROLL_DICE_TIME),
+		HERO_VOICE(Config.HERO_VOICE_TIME),
+		SUBCLASS(Config.SUBCLASS_TIME),
+		DROP_ITEM(Config.DROP_ITEM_TIME),
+		SERVER_BYPASS(Config.SERVER_BYPASS_TIME),
+		MULTISELL(Config.MULTISELL_TIME),
+		MANUFACTURE(Config.MANUFACTURE_TIME),
+		MANOR(Config.MANOR_TIME),
+		SENDMAIL(Config.SENDMAIL_TIME),
+		CHARACTER_SELECT(Config.CHARACTER_SELECT_TIME),
+		GLOBAL_CHAT(Config.GLOBAL_CHAT_TIME),
+		TRADE_CHAT(Config.TRADE_CHAT_TIME),
+		SOCIAL(Config.SOCIAL_TIME);
+		
+		private final int _reuseDelay;
+		
+		private Action(int reuseDelay)
+		{
+			_reuseDelay = reuseDelay;
+		}
+		
+		public int getReuseDelay()
+		{
+			return _reuseDelay;
+		}
+		
+		public static final int VALUES_LENGTH = Action.values().length;
+	}
 	
 	/**
-	 * Creates new instance of FloodProtectors.
-	 * @param client client for which the collection of flood protectors is being created.
+	 * Try to perform an action according to client FPs value. A 0 reuse delay means the action is always possible.
+	 * @param client : The client to check protectors on.
+	 * @param action : The action to track.
+	 * @return True if the action is possible, False otherwise.
 	 */
-	public FloodProtectors(final L2GameClient client)
+	public static boolean performAction(L2GameClient client, Action action)
 	{
-		super();
-		_rollDice = new FloodProtectorAction(client, Config.FLOOD_PROTECTOR_ROLL_DICE);
-		_heroVoice = new FloodProtectorAction(client, Config.FLOOD_PROTECTOR_HERO_VOICE);
-		_subclass = new FloodProtectorAction(client, Config.FLOOD_PROTECTOR_SUBCLASS);
-		_dropItem = new FloodProtectorAction(client, Config.FLOOD_PROTECTOR_DROP_ITEM);
-		_serverBypass = new FloodProtectorAction(client, Config.FLOOD_PROTECTOR_SERVER_BYPASS);
-		_multiSell = new FloodProtectorAction(client, Config.FLOOD_PROTECTOR_MULTISELL);
-		_manufacture = new FloodProtectorAction(client, Config.FLOOD_PROTECTOR_MANUFACTURE);
-		_manor = new FloodProtectorAction(client, Config.FLOOD_PROTECTOR_MANOR);
-		_sendMail = new FloodProtectorAction(client, Config.FLOOD_PROTECTOR_SENDMAIL);
-		_characterSelect = new FloodProtectorAction(client, Config.FLOOD_PROTECTOR_CHARACTER_SELECT);
-	}
-	
-	public FloodProtectorAction getRollDice()
-	{
-		return _rollDice;
-	}
-	
-	public FloodProtectorAction getHeroVoice()
-	{
-		return _heroVoice;
-	}
-	
-	public FloodProtectorAction getSubclass()
-	{
-		return _subclass;
-	}
-	
-	public FloodProtectorAction getDropItem()
-	{
-		return _dropItem;
-	}
-	
-	public FloodProtectorAction getServerBypass()
-	{
-		return _serverBypass;
-	}
-	
-	public FloodProtectorAction getMultiSell()
-	{
-		return _multiSell;
-	}
-	
-	public FloodProtectorAction getManufacture()
-	{
-		return _manufacture;
-	}
-	
-	public FloodProtectorAction getManor()
-	{
-		return _manor;
-	}
-	
-	public FloodProtectorAction getSendMail()
-	{
-		return _sendMail;
-	}
-	
-	public FloodProtectorAction getCharacterSelect()
-	{
-		return _characterSelect;
+		final int reuseDelay = action.getReuseDelay();
+		if (reuseDelay == 0)
+			return true;
+		
+		long[] value = client.getFloodProtectors();
+		
+		synchronized (value)
+		{
+			if (value[action.ordinal()] > System.currentTimeMillis())
+				return false;
+			
+			value[action.ordinal()] = System.currentTimeMillis() + reuseDelay;
+			return true;
+		}
 	}
 }
Index: unk/aCis_gameserver/java/net/sf/l2j/gameserver/util/FloodProtectorAction.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/util/FloodProtectorAction.java	(revision 341)
+++ 	(revision )
@@ -1,185 +1,0 @@
-/*
- * This program is free software: you can redistribute it and/or modify it under the terms of the
- * GNU General Public License as published by the Free Software Foundation, either version 3 of the
- * License, or (at your option) any later version.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
- * even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
- * General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with this program. If
- * not, see <http://www.gnu.org/licenses/>.
- */
-package net.sf.l2j.gameserver.util;
-
-import java.util.concurrent.atomic.AtomicInteger;
-import java.util.logging.Level;
-import java.util.logging.Logger;
-
-import net.sf.l2j.gameserver.model.actor.instance.L2PcInstance;
-import net.sf.l2j.gameserver.network.L2GameClient;
-import net.sf.l2j.util.StringUtil;
-
-/**
- * Flood protector implementation.
- * @author fordfrog
- */
-public final class FloodProtectorAction
-{
-	private static final Logger _log = Logger.getLogger(FloodProtectorAction.class.getName());
-	
-	private final L2GameClient _client;
-	private final FloodProtectorConfig _config;
-	
-	private volatile long _lastTime = System.currentTimeMillis();
-	private final AtomicInteger _count = new AtomicInteger(0);
-	
-	private boolean _logged;
-	
-	private volatile boolean _punishmentInProgress;
-	
-	/**
-	 * Creates new instance of FloodProtectorAction.
-	 * @param client client for which flood protection is being created
-	 * @param config flood protector configuration
-	 */
-	public FloodProtectorAction(final L2GameClient client, final FloodProtectorConfig config)
-	{
-		super();
-		_client = client;
-		_config = config;
-	}
-	
-	/**
-	 * Checks whether the request is flood protected or not.
-	 * @param command command issued or short command description
-	 * @return true if action is allowed, otherwise false
-	 */
-	public boolean tryPerformAction(final String command)
-	{
-		final long time = System.currentTimeMillis();
-		
-		if (time < _lastTime || _punishmentInProgress)
-		{
-			if (_config.LOG_FLOODING && !_logged && _log.isLoggable(Level.WARNING))
-			{
-				log(" called command ", command, " ~", String.valueOf((_config.FLOOD_PROTECTION_INTERVAL - (_lastTime - time))), " ms after previous command");
-				_logged = true;
-			}
-			
-			_count.incrementAndGet();
-			
-			if (!_punishmentInProgress && _config.PUNISHMENT_LIMIT > 0 && _count.get() >= _config.PUNISHMENT_LIMIT && _config.PUNISHMENT_TYPE != null)
-			{
-				_punishmentInProgress = true;
-				
-				if ("kick".equals(_config.PUNISHMENT_TYPE))
-					kickPlayer();
-				else if ("ban".equals(_config.PUNISHMENT_TYPE))
-					banAccount();
-				else if ("jail".equals(_config.PUNISHMENT_TYPE))
-					jailChar();
-				
-				_punishmentInProgress = false;
-			}
-			
-			return false;
-		}
-		
-		if (_count.get() > 0)
-		{
-			if (_config.LOG_FLOODING && _log.isLoggable(Level.WARNING))
-				log(" issued ", String.valueOf(_count), " extra requests within ~", String.valueOf(_config.FLOOD_PROTECTION_INTERVAL), " ms");
-		}
-		
-		_lastTime = time + _config.FLOOD_PROTECTION_INTERVAL;
-		_logged = false;
-		_count.set(0);
-		
-		return true;
-	}
-	
-	/**
-	 * Kick player from game (close network connection).
-	 */
-	private void kickPlayer()
-	{
-		if (_client.getActiveChar() != null)
-			_client.getActiveChar().logout(false);
-		else
-			_client.closeNow();
-		
-		if (_log.isLoggable(Level.WARNING))
-			log("kicked for flooding");
-	}
-	
-	/**
-	 * Bans char account and logs out the char.
-	 */
-	private void banAccount()
-	{
-		if (_client.getActiveChar() != null)
-		{
-			_client.getActiveChar().setPunishLevel(L2PcInstance.PunishLevel.ACC, _config.PUNISHMENT_TIME);
-			
-			if (_log.isLoggable(Level.WARNING))
-				log(" banned for flooding ", _config.PUNISHMENT_TIME <= 0 ? "forever" : "for " + _config.PUNISHMENT_TIME + " mins");
-			
-			_client.getActiveChar().logout();
-		}
-		else
-			log(" unable to ban account: no active player");
-	}
-	
-	/**
-	 * Jails char.
-	 */
-	private void jailChar()
-	{
-		if (_client.getActiveChar() != null)
-		{
-			_client.getActiveChar().setPunishLevel(L2PcInstance.PunishLevel.JAIL, _config.PUNISHMENT_TIME);
-			
-			if (_log.isLoggable(Level.WARNING))
-				log(" jailed for flooding ", _config.PUNISHMENT_TIME <= 0 ? "forever" : "for " + _config.PUNISHMENT_TIME + " mins");
-		}
-		else
-			log(" unable to jail: no active player");
-	}
-	
-	private void log(String... lines)
-	{
-		final StringBuilder output = StringUtil.startAppend(100, _config.FLOOD_PROTECTOR_TYPE, ": ");
-		String address = null;
-		try
-		{
-			if (!_client.isDetached())
-				address = _client.getConnection().getInetAddress().getHostAddress();
-		}
-		catch (Exception e)
-		{
-		}
-		
-		switch (_client.getState())
-		{
-			case IN_GAME:
-				if (_client.getActiveChar() != null)
-				{
-					StringUtil.append(output, _client.getActiveChar().getName());
-					StringUtil.append(output, "(", String.valueOf(_client.getActiveChar().getObjectId()), ") ");
-				}
-			case AUTHED:
-				if (_client.getAccountName() != null)
-					StringUtil.append(output, _client.getAccountName(), " ");
-			case CONNECTED:
-				if (address != null)
-					StringUtil.append(output, address);
-				break;
-			default:
-				throw new IllegalStateException("Missing state on switch");
-		}
-		
-		StringUtil.append(output, lines);
-		_log.warning(output.toString());
-	}
-}
Index: unk/aCis_gameserver/java/net/sf/l2j/gameserver/util/FloodProtectorConfig.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/gameserver/util/FloodProtectorConfig.java	(revision 341)
+++ 	(revision )
@@ -1,42 +1,0 @@
-/*
- * This program is free software: you can redistribute it and/or modify it under the terms of the
- * GNU General Public License as published by the Free Software Foundation, either version 3 of the
- * License, or (at your option) any later version.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
- * even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
- * General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with this program. If
- * not, see <http://www.gnu.org/licenses/>.
- */
-package net.sf.l2j.gameserver.util;
-
-/**
- * Flood protector configuration
- * @author fordfrog
- */
-public final class FloodProtectorConfig
-{
-	public String FLOOD_PROTECTOR_TYPE;
-	
-	public int FLOOD_PROTECTION_INTERVAL;
-	
-	public boolean LOG_FLOODING;
-	
-	public int PUNISHMENT_LIMIT;
-	
-	public String PUNISHMENT_TYPE;
-	
-	public int PUNISHMENT_TIME;
-	
-	/**
-	 * Creates new instance of FloodProtectorConfig.
-	 * @param floodProtectorType {@link #FLOOD_PROTECTOR_TYPE}
-	 */
-	public FloodProtectorConfig(final String floodProtectorType)
-	{
-		super();
-		FLOOD_PROTECTOR_TYPE = floodProtectorType;
-	}
-}
Index: /trunk/aCis_gameserver/java/net/sf/l2j/Config.java
===================================================================
--- /trunk/aCis_gameserver/java/net/sf/l2j/Config.java	(revision 341)
+++ /trunk/aCis_gameserver/java/net/sf/l2j/Config.java	(revision 342)
@@ -33,5 +33,4 @@
 import net.sf.l2j.gameserver.model.holder.BuffSkillHolder;
 import net.sf.l2j.gameserver.model.holder.ItemHolder;
-import net.sf.l2j.gameserver.util.FloodProtectorConfig;
 import net.sf.l2j.util.StringUtil;
 
@@ -47,5 +46,4 @@
 	public static final String CLANS_FILE = "./config/clans.properties";
 	public static final String EVENTS_FILE = "./config/events.properties";
-	public static final String FLOOD_PROTECTOR_FILE = "./config/floodprotector.properties";
 	public static final String GEOENGINE_FILE = "./config/geoengine.properties";
 	public static final String HEXID_FILE = "./config/hexid.txt";
@@ -257,19 +255,4 @@
 	
 	// --------------------------------------------------
-	// FloodProtectors
-	// --------------------------------------------------
-	
-	public static FloodProtectorConfig FLOOD_PROTECTOR_ROLL_DICE;
-	public static FloodProtectorConfig FLOOD_PROTECTOR_HERO_VOICE;
-	public static FloodProtectorConfig FLOOD_PROTECTOR_SUBCLASS;
-	public static FloodProtectorConfig FLOOD_PROTECTOR_DROP_ITEM;
-	public static FloodProtectorConfig FLOOD_PROTECTOR_SERVER_BYPASS;
-	public static FloodProtectorConfig FLOOD_PROTECTOR_MULTISELL;
-	public static FloodProtectorConfig FLOOD_PROTECTOR_MANUFACTURE;
-	public static FloodProtectorConfig FLOOD_PROTECTOR_MANOR;
-	public static FloodProtectorConfig FLOOD_PROTECTOR_SENDMAIL;
-	public static FloodProtectorConfig FLOOD_PROTECTOR_CHARACTER_SELECT;
-	
-	// --------------------------------------------------
 	// Loginserver
 	// --------------------------------------------------
@@ -640,4 +623,19 @@
 	public static String BBS_DEFAULT;
 	
+	/** Flood Protectors */
+	public static int ROLL_DICE_TIME;
+	public static int HERO_VOICE_TIME;
+	public static int SUBCLASS_TIME;
+	public static int DROP_ITEM_TIME;
+	public static int SERVER_BYPASS_TIME;
+	public static int MULTISELL_TIME;
+	public static int MANUFACTURE_TIME;
+	public static int MANOR_TIME;
+	public static int SENDMAIL_TIME;
+	public static int CHARACTER_SELECT_TIME;
+	public static int GLOBAL_CHAT_TIME;
+	public static int TRADE_CHAT_TIME;
+	public static int SOCIAL_TIME;
+	
 	/** Misc */
 	public static boolean L2WALKER_PROTECTION;
@@ -690,16 +688,4 @@
 		if (Server.serverMode == Server.MODE_GAMESERVER)
 		{
-			_log.info("Loading flood protectors.");
-			FLOOD_PROTECTOR_ROLL_DICE = new FloodProtectorConfig("RollDiceFloodProtector");
-			FLOOD_PROTECTOR_HERO_VOICE = new FloodProtectorConfig("HeroVoiceFloodProtector");
-			FLOOD_PROTECTOR_SUBCLASS = new FloodProtectorConfig("SubclassFloodProtector");
-			FLOOD_PROTECTOR_DROP_ITEM = new FloodProtectorConfig("DropItemFloodProtector");
-			FLOOD_PROTECTOR_SERVER_BYPASS = new FloodProtectorConfig("ServerBypassFloodProtector");
-			FLOOD_PROTECTOR_MULTISELL = new FloodProtectorConfig("MultiSellFloodProtector");
-			FLOOD_PROTECTOR_MANUFACTURE = new FloodProtectorConfig("ManufactureFloodProtector");
-			FLOOD_PROTECTOR_MANOR = new FloodProtectorConfig("ManorFloodProtector");
-			FLOOD_PROTECTOR_SENDMAIL = new FloodProtectorConfig("SendMailFloodProtector");
-			FLOOD_PROTECTOR_CHARACTER_SELECT = new FloodProtectorConfig("CharacterSelectFloodProtector");
-			
 			_log.info("Loading gameserver configuration files.");
 			
@@ -860,17 +846,4 @@
 			ALT_FISH_CHAMPIONSHIP_REWARD_5 = events.getProperty("AltFishChampionshipReward5", 100000);
 			
-			// FloodProtector
-			ExProperties security = load(FLOOD_PROTECTOR_FILE);
-			loadFloodProtectorConfig(security, FLOOD_PROTECTOR_ROLL_DICE, "RollDice", "42");
-			loadFloodProtectorConfig(security, FLOOD_PROTECTOR_HERO_VOICE, "HeroVoice", "100");
-			loadFloodProtectorConfig(security, FLOOD_PROTECTOR_SUBCLASS, "Subclass", "20");
-			loadFloodProtectorConfig(security, FLOOD_PROTECTOR_DROP_ITEM, "DropItem", "10");
-			loadFloodProtectorConfig(security, FLOOD_PROTECTOR_SERVER_BYPASS, "ServerBypass", "5");
-			loadFloodProtectorConfig(security, FLOOD_PROTECTOR_MULTISELL, "MultiSell", "1");
-			loadFloodProtectorConfig(security, FLOOD_PROTECTOR_MANUFACTURE, "Manufacture", "3");
-			loadFloodProtectorConfig(security, FLOOD_PROTECTOR_MANOR, "Manor", "30");
-			loadFloodProtectorConfig(security, FLOOD_PROTECTOR_SENDMAIL, "SendMail", "100");
-			loadFloodProtectorConfig(security, FLOOD_PROTECTOR_CHARACTER_SELECT, "CharacterSelect", "30");
-			
 			// Geoengine
 			ExProperties geoengine = load(GEOENGINE_FILE);
@@ -1236,4 +1209,18 @@
 			BBS_DEFAULT = server.getProperty("BBSDefault", "_bbshome");
 			
+			ROLL_DICE_TIME = server.getProperty("RollDiceTime", 4200);
+			HERO_VOICE_TIME = server.getProperty("HeroVoiceTime", 10000);
+			SUBCLASS_TIME = server.getProperty("SubclassTime", 2000);
+			DROP_ITEM_TIME = server.getProperty("DropItemTime", 1000);
+			SERVER_BYPASS_TIME = server.getProperty("ServerBypassTime", 500);
+			MULTISELL_TIME = server.getProperty("MultisellTime", 100);
+			MANUFACTURE_TIME = server.getProperty("ManufactureTime", 300);
+			MANOR_TIME = server.getProperty("ManorTime", 3000);
+			SENDMAIL_TIME = server.getProperty("SendMailTime", 10000);
+			CHARACTER_SELECT_TIME = server.getProperty("CharacterSelectTime", 3000);
+			GLOBAL_CHAT_TIME = server.getProperty("GlobalChatTime", 0);
+			TRADE_CHAT_TIME = server.getProperty("TradeChatTime", 0);
+			SOCIAL_TIME = server.getProperty("SocialTime", 2000);
+			
 			L2WALKER_PROTECTION = server.getProperty("L2WalkerProtection", false);
 			AUTODELETE_INVALID_QUEST_DATA = server.getProperty("AutoDeleteInvalidQuestData", false);
@@ -1317,20 +1304,4 @@
 			e.printStackTrace();
 		}
-	}
-	
-	/**
-	 * Loads single flood protector configuration.
-	 * @param properties L2Properties file reader
-	 * @param config flood protector configuration instance
-	 * @param configString flood protector configuration string that determines for which flood protector configuration should be read
-	 * @param defaultInterval default flood protector interval
-	 */
-	private static void loadFloodProtectorConfig(final Properties properties, final FloodProtectorConfig config, final String configString, final String defaultInterval)
-	{
-		config.FLOOD_PROTECTION_INTERVAL = Integer.parseInt(properties.getProperty(StringUtil.concat("FloodProtector", configString, "Interval"), defaultInterval));
-		config.LOG_FLOODING = Boolean.parseBoolean(properties.getProperty(StringUtil.concat("FloodProtector", configString, "LogFlooding"), "False"));
-		config.PUNISHMENT_LIMIT = Integer.parseInt(properties.getProperty(StringUtil.concat("FloodProtector", configString, "PunishmentLimit"), "0"));
-		config.PUNISHMENT_TYPE = properties.getProperty(StringUtil.concat("FloodProtector", configString, "PunishmentType"), "none");
-		config.PUNISHMENT_TIME = Integer.parseInt(properties.getProperty(StringUtil.concat("FloodProtector", configString, "PunishmentTime"), "0"));
 	}
 	
Index: /trunk/aCis_gameserver/config/server.properties
===================================================================
--- /trunk/aCis_gameserver/config/server.properties	(revision 341)
+++ /trunk/aCis_gameserver/config/server.properties	(revision 342)
@@ -268,4 +268,23 @@
 
 # =================================================================
+#                          Flood Protectors
+# =================================================================
+
+# The values are shown on ms. They can be setted to 0 to be disabled.
+RollDiceTime = 4200
+HeroVoiceTime = 10000
+SubclassTime = 2000
+DropItemTime = 1000
+ServerBypassTime = 500
+MultisellTime = 100
+ManufactureTime = 300
+ManorTime = 3000
+SendMailTime = 10000
+CharacterSelectTime = 3000
+GlobalChatTime = 0
+TradeChatTime = 0
+SocialTime = 2000
+
+# =================================================================
 #                                Misc
 # =================================================================
Index: unk/aCis_gameserver/config/floodprotector.properties
===================================================================
--- /trunk/aCis_gameserver/config/floodprotector.properties	(revision 341)
+++ 	(revision )
@@ -1,79 +1,0 @@
-#=============================================================
-#                       FloodProtector
-#=============================================================
-# The following settings can be applied to each feature:
-# Interval - interval in ms, in which only one request is allowed
-# LogFlooding - whether flooding should be logged (only first ocurrance of flooding and total count of flood requests is logged)
-# PunishmentLimit - if number of requests within single interval exceeds specified number then the specified punishment is applied (0 = disables punishment feature)
-# PunishmentType - type of the punishment ('none', 'kick', 'ban', 'jail'), valid only if PunishmentLimit is greater than 0
-# PunishmentTime - for how many minutes should the player(jail)/account(ban) be punished (0 = forever), valid only for PunishmentType 'jail' or 'ban'
-
-# RollDice - rolling dice flooding
-FloodProtectorRollDiceInterval = 4200
-FloodProtectorRollDiceLogFlooding = False
-FloodProtectorRollDicePunishmentLimit = 0
-FloodProtectorRollDicePunishmentType = none
-FloodProtectorRollDicePunishmentTime = 0
-
-# HeroVoice - hero voice flooding, 10s on retail
-FloodProtectorHeroVoiceInterval = 10000
-FloodProtectorHeroVoiceLogFlooding = False
-FloodProtectorHeroVoicePunishmentLimit = 0
-FloodProtectorHeroVoicePunishmentType = none
-FloodProtectorHeroVoicePunishmentTime = 0
-
-# Subclass - subclass flooding
-FloodProtectorSubclassInterval = 2000
-FloodProtectorSubclassLogFlooding = False
-FloodProtectorSubclassPunishmentLimit = 0
-FloodProtectorSubclassPunishmentType = none
-FloodProtectorSubclassPunishmentTime = 0
-
-# DropItem - drop item flooding
-FloodProtectorDropItemInterval = 1000
-FloodProtectorDropItemLogFlooding = False
-FloodProtectorDropItemPunishmentLimit = 0
-FloodProtectorDropItemPunishmentType = none
-FloodProtectorDropItemPunishmentTime = 0
-
-# ServerBypass - server bypass flooding
-FloodProtectorServerBypassInterval = 500
-FloodProtectorServerBypassLogFlooding = False
-FloodProtectorServerBypassPunishmentLimit = 0
-FloodProtectorServerBypassPunishmentType = none
-FloodProtectorServerBypassPunishmentTime = 0
-
-# ServerBypass - multisell list request flooding
-FloodProtectorMultiSellInterval = 100
-FloodProtectorMultiSellLogFlooding = False
-FloodProtectorMultiSellPunishmentLimit = 0
-FloodProtectorMultiSellPunishmentType = none
-FloodProtectorMultiSellPunishmentTime = 0
-
-# Manufacture
-FloodProtectorManufactureInterval = 300
-FloodProtectorManufactureLogFlooding = False
-FloodProtectorManufacturePunishmentLimit = 0
-FloodProtectorManufacturePunishmentType = none
-FloodProtectorManufacturePunishmentTime = 0
-
-# Manor
-FloodProtectorManorInterval = 3000
-FloodProtectorManorLogFlooding = False
-FloodProtectorManorPunishmentLimit = 0
-FloodProtectorManorPunishmentType = none
-FloodProtectorManorPunishmentTime = 0
-
-# SendMail - sending mail interval, 10s on retail
-FloodProtectorSendMailInterval = 10000
-FloodProtectorSendMailLogFlooding = False
-FloodProtectorSendMailPunishmentLimit = 0
-FloodProtectorSendMailPunishmentType = none
-FloodProtectorSendMailPunishmentTime = 0
-
-# CharacterSelect - attempts to load character
-FloodProtectorCharacterSelectInterval = 3000
-FloodProtectorCharacterSelectLogFlooding = False
-FloodProtectorCharacterSelectPunishmentLimit = 0
-FloodProtectorCharacterSelectPunishmentType = none
-FloodProtectorCharacterSelectPunishmentTime = 0
Index: /trunk/aCis_datapack/data/html/default/30702.htm
===================================================================
--- /trunk/aCis_datapack/data/html/default/30702.htm	(revision 341)
+++ /trunk/aCis_datapack/data/html/default/30702.htm	(revision 342)
@@ -1,6 +1,6 @@
 <html><body>Hunters Guild President Bernard:<br>
-Welcome to the Hunters Village, yong friend. As you know, our village was first formed by hunters. We have a great tradition around here, and do not stop others from hunting near our village. We hunters must all stick together, don't you think?<br>
+Welcome to the Hunters Village, young friend. As you know, our village was first formed by hunters. We have a great tradition around here, and do not stop others from hunting near our village. We hunters must all stick together, don't you think?<br>
 On the other hand, there are too many young hunters today who disregard the rules... Even needlessly fighting in the village... To prevent any trouble I hope you follow these rules:<br>
-Never hunt another Hunter's prey and never take what another Hunter has captured... Easy huh? I think these are the most basic rules not only Hunters but every Human being should follow. Do you aggre?<br>
+Never hunt another Hunter's prey and never take what another Hunter has captured... Easy huh? I think these are the most basic rules not only Hunters but every Human being should follow. Do you agree?<br>
 Whoever breaks these rules, I will kick out of the village!<br>
 <a action="bypass -h npc_%objectId%_Quest">Quest</a>
Index: /trunk/aCis_datapack/data/html/default/31603.htm
===================================================================
--- /trunk/aCis_datapack/data/html/default/31603.htm	(revision 341)
+++ /trunk/aCis_datapack/data/html/default/31603.htm	(revision 342)
@@ -1,13 +1,13 @@
 <html><body>Black Cat:<br>
-I, kiddo!<br>
+Hi, kiddo!<br>
 Ha! Does my calling you "kiddo" offend you?<br>
-Well, I've lived for undreds of years, so everyone is a kid to me!<br>
+Well, I've lived for hundreds of years, so everyone is a kid to me!<br>
 Heed my words, my young friend! I've never allowed anything to stand between me and my goals, not even decency!<br>
 But recently, my past evil deeds have begun to haunt my dreams... I've begun to question my mercenary existence...<br>
-What if I had lived and ordinary life?<br>
+What if I had lived an ordinary life?<br>
 Maybe I'm just old and sentimental, eh?<br>
 ...<br>
 Well, there's no use crying over spilt milk...<br>
-I Have no choise now but to continue climbing until I fall...<br>
+I have no choice now but to continue climbing until I fall...<br>
 <a action="bypass -h npc_%objectId%_Quest">Quest</a>
 </body></html>
Index: /trunk/aCis_datapack/data/html/default/30703-1.htm
===================================================================
--- /trunk/aCis_datapack/data/html/default/30703-1.htm	(revision 341)
+++ /trunk/aCis_datapack/data/html/default/30703-1.htm	(revision 342)
@@ -1,5 +1,5 @@
 <html><body>Hunters Guild Member Colin:<br>
-The Hunters Guild is a brotherhood of extraordinary Hunters. We are professionals, constantly honing our skills... We hunt prey never imaginated by tipical hunters... You will know the details soon...<br>
-the Hunters Guild is a somewhat autonomous. Even though Castle Aden has dispatched Guards, we are capable of defending ourselves. The Guards are aware of this and even approve, but our town stubbornly insist that the Guards stay here...<br>
+The Hunters Guild is a brotherhood of extraordinary Hunters. We are professionals, constantly honing our skills... We hunt prey never imagined by typical hunters... You will know the details soon...<br>
+The Hunters Guild is somewhat autonomous. Even though Castle Aden has dispatched Guards, we are capable of defending ourselves. The Guards are aware of this and even approve, but our town stubbornly insists that the Guards stay here...<br>
 It is a somewhat complicated story...<br>
 <a action="bypass -h npc_%objectId%_Chat 0">Return</a>
Index: /trunk/aCis_datapack/data/scripts.cfg
===================================================================
--- /trunk/aCis_datapack/data/scripts.cfg	(revision 341)
+++ /trunk/aCis_datapack/data/scripts.cfg	(revision 342)
@@ -167,9 +167,9 @@
 quests/Q222_TestOfTheDuelist/Q222_TestOfTheDuelist.java
 quests/Q223_TestOfTheChampion/Q223_TestOfTheChampion.java
-#quests/Q224_TestOfSagittarius/Q224_TestOfSagittarius.java
+quests/Q224_TestOfSagittarius/Q224_TestOfSagittarius.java
 quests/Q225_TestOfTheSearcher/Q225_TestOfTheSearcher.java
 #quests/Q226_TestOfTheHealer/Q226_TestOfTheHealer.java
 #quests/Q227_TestOfTheReformer/Q227_TestOfTheReformer.java
-#quests/Q228_TestOfMagus/Q228_TestOfMagus.java
+quests/Q228_TestOfMagus/Q228_TestOfMagus.java
 #quests/Q229_TestOfWitchcraft/Q229_TestOfWitchcraft.java
 quests/Q230_TestOfTheSummoner/Q230_TestOfTheSummoner.java
@@ -364,5 +364,5 @@
 quests/Q661_MakingTheHarvestGroundsSafe/Q661_MakingTheHarvestGroundsSafe.java
 quests/Q662_AGameOfCards/Q662_AGameOfCards.java
-#quests/Q663_SeductiveWhispers/Q663_SeductiveWhispers.java
+quests/Q663_SeductiveWhispers/Q663_SeductiveWhispers.java
 quests/Q688_DefeatTheElrokianRaiders/Q688_DefeatTheElrokianRaiders.java
 quests/SagasScripts/SagasSuperClass.java
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30413-01.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30413-01.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30413-01.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Water Undine:<br>
+I am Undine, guardian of the deep lake, spirit of the precious water... Have you come for the Tone of Water?<br>
+It is the rhythm which expresses the nature of water among the four basic elements which compose the earth... To create this, you need 20 Dazzling Drops from the monsters of the marshlands.<br>
+Toad lords which live in the Cruma Marshlands... And the swamp stakatos have the Dazzling Drops. If you bring 20 of them, I shall make you the tone. This amulet is a symbol of my promise...
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30411-03.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30411-03.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30411-03.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Flame Salamander:<br>
+Five Flame Crystals... Oh how lovely. Here is the Note of Fire. Take it!
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30413-02.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30413-02.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30413-02.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Water Undine:<br>
+We need 20 Dazzling Drops to make the Tone of Water. Hunt toad lords and swamp stakatos in the Cruma Marshlands and take it from them. Now, hurry! You promised, didn't you?
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30411-04.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30411-04.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30411-04.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Flame Salamander:<br>
+I trust you are taking good care of the Note of Fire that I have given you... I hope you realize that that note is the strongest, and has the deepest tone of all 4 of the elemental notes...
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30413-03.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30413-03.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30413-03.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Water Undine:<br>
+...18, 19, 20... Good... You have brought 20. I shall give you the Tone of Water.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30413-04.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30413-04.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30413-04.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Water Undine:<br>
+I assume that you seek the Tones of Fire, Wind, Earth as well? They are all my brothers and sisters... Please give them my regards...
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30409-01.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30409-01.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30409-01.htm	(revision 342)
@@ -0,0 +1,6 @@
+<html><body>Earth Snake:<br>
+I am an element of this earth. The truths of the universe within the earth are within me.<br>
+So, you seek the Note of the Earth? What do you expect to do with it...? Do you plan to create absolute music?<br>
+Is that it...? And what then...?<br>
+<a action="bypass -h Quest Q228_TestOfMagus 30409-02.htm">"I will use it to bring the thousand year flower into bloom."</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30409-02.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30409-02.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30409-02.htm	(revision 342)
@@ -0,0 +1,6 @@
+<html><body>Earth Snake:<br>
+Ahhh, the thousand year flower! I see... So you seek the golden seed and the 4 elemental notes, then?<br>
+Well, I guess it doesn't matter... Yes, I will give you the Note of the Earth. But you must find out something for me first.<br>
+In that place that the Humans call Oren, near the Ivory Tower, I have seen monsters. They seem similar to those from the place called Gludio, but much stronger than any that I have ever seen... Why is this happening? I must know!<br>
+<a action="bypass -h Quest Q228_TestOfMagus 30409-03.htm">"Which monsters must I investigate?"</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30409-03.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30409-03.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30409-03.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Earth Snake:<br>
+Enchanted Monster Eye, Enchanted Stone Golem, Enchanted Iron Golem... These are the monsters you must slay. You must kill them and bring me what they carry... and plenty of it!<br>
+Ten! Yes! Ten from each will do!<br>
+Take this totem with you as a reminder of your promise...
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30409-04.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30409-04.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30409-04.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Earth Snake:<br>
+There are not 10 items here...Did you think I would not notice? I will not give you the Note of the Earth until you bring me proof that you have slain 10 each of the Enchanted Monster Eye, Enchanted Stone Golem and Enchanted Iron Golem.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-01.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-01.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-01.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Bard Rukal:<br>
+To see a Mystic command the ultimate elemental magic is somewhat like hearing a song from heaven. Unlike other magic, Elemental Magic consists of combining the songs of the spirits.<br>
+Your ears are not sophisticated enough to hear the elemental tones? I suppose a cacophony of swords and shields or a hymn of prayer and blessings would be easier for you to hear.<br>
+(Quest for Wizards, Elven Wizards and Dark Wizards, level 39 or above.)
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30409-05.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30409-05.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30409-05.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Earth Snake:<br>
+1, 2, 3... Yes... I think you have brought all that I asked for. I shall bestow upon you the Note of the Earth. May you create beautiful music with this and make the thousand year flower bloom...
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-02.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-02.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-02.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Bard Rukal:<br>
+To see a Mystic combining the songs of the spirits while commanding elemental magic is like hearing a song straight from heaven.<br>
+A Mystic must have a thorough understanding of the elements of tone. Come back when you have more experience.<br>
+(Quest for Wizard, Elven Wizard, or Dark Wizard. Level 39 or above.)
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30409-06.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30409-06.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30409-06.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Earth Snake:<br>
+Have you acquired the notes of water, wind, and flame? The Note of the Earth is a deeper and more solemn tone than the other notes... Only when the 4 different notes combine together can the most beautiful music be played... The absolute music...
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-03.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-03.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-03.htm	(revision 342)
@@ -0,0 +1,6 @@
+<html><body>Bard Rukal:<br>
+Elemental magic is like a song from heaven. Combining the songs of the spirits is fundamental in the use of elemental magic.<br>
+Mystics must have a complete understanding of the elements of tone.<br>
+The Test of the Magus will assess your understanding of the tones of the 4 elements. Those who pass this test will have a chance to advance to the higher level of Elemental Magic..<br>
+<a action="bypass -h Quest Q228_TestOfMagus 30629-04a.htm">Take the Test of the Magus</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-04.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-04.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-04.htm	(revision 342)
@@ -0,0 +1,7 @@
+<html><body>Bard Rukal:<br>
+Good. First let me tell you something about myself.<br>
+My nights are sleepless, haunted by the songs of the spirits. This is a condition common to the practitioners of Elemental Magic.<br>
+This inhuman song is not of this earth, and can make the hair stand up on the back of your neck, and a cold shiver run down your spine.<br>
+You must find the source of this music. I know someone who can help you. I will introduce you to Parina, who is in the temple of Gludin. She has a profound knowledge of Elemental Magic.<br>
+She will help you find the source of this unworldly music if you show her this letter.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-04a.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-04a.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-04a.htm	(revision 342)
@@ -0,0 +1,8 @@
+<html><body>Bard Rukal:<br>
+Very well. Listen to my story, youngster.<br>
+Blissful slumber escapes me night after night. In the quiet darkness, I am haunted by a strange melody that reaches my ears, a music that can only be heard by those who have mastered elemental magic.<br>
+Low-pitched and subtle, it nevertheless grates upon my sensitive nerves. Humans cannot make this kind of otherworldy melody, I am convinced, and it is certainly not a magician's aria.<br>
+Your task is to find the source of this ominous sound. To begin your investigation, visit Parina from the temple in Gludin Town.<br>
+A master of elemental magic, perhaps he knows something about this eerie nighttime melody. I must be able to sleep! Show him this letter and I am sure that he will help you.<br>
+Oh, and take this <font color="LEVEL">Dimension Diamond</font>. You can trade it to the village gatekeeper for something special that may help you on your journey.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-05.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-05.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-05.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Bard Rukal:<br>
+The strange songs of the spirits will still not let me sleep. Please go meet Parina and investigate the origin of this music.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-06.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-06.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-06.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Bard Rukal:<br>
+This is very disturbing. That song was from the legendary evil spirit Singing Flower. As Parina advised you, you should go and meet Elder Casian. He will tell you more about Singing Flower.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/Q228_TestOfMagus.java
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/Q228_TestOfMagus.java	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/Q228_TestOfMagus.java	(revision 342)
@@ -0,0 +1,465 @@
+/*
+ * This program is free software: you can redistribute it and/or modify it under
+ * the terms of the GNU General Public License as published by the Free Software
+ * Foundation, either version 3 of the License, or (at your option) any later
+ * version.
+ * 
+ * This program is distributed in the hope that it will be useful, but WITHOUT
+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
+ * FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
+ * details.
+ * 
+ * You should have received a copy of the GNU General Public License along with
+ * this program. If not, see <http://www.gnu.org/licenses/>.
+ */
+package quests.Q228_TestOfMagus;
+
+import net.sf.l2j.gameserver.model.actor.L2Npc;
+import net.sf.l2j.gameserver.model.actor.instance.L2PcInstance;
+import net.sf.l2j.gameserver.model.base.ClassId;
+import net.sf.l2j.gameserver.model.quest.Quest;
+import net.sf.l2j.gameserver.model.quest.QuestState;
+import net.sf.l2j.gameserver.network.serverpackets.SocialAction;
+
+public class Q228_TestOfMagus extends Quest
+{
+	private static final String qn = "Q228_TestOfMagus";
+	
+	// Items
+	private static final int RUKAL_LETTER = 2841;
+	private static final int PARINA_LETTER = 2842;
+	private static final int LILAC_CHARM = 2843;
+	private static final int GOLDEN_SEED_1 = 2844;
+	private static final int GOLDEN_SEED_2 = 2845;
+	private static final int GOLDEN_SEED_3 = 2846;
+	private static final int SCORE_OF_ELEMENTS = 2847;
+	private static final int DAZZLING_DROP = 2848;
+	private static final int FLAME_CRYSTAL = 2849;
+	private static final int HARPY_FEATHER = 2850;
+	private static final int WYRM_WINGBONE = 2851;
+	private static final int WINDSUS_MANE = 2852;
+	private static final int EN_MONSTEREYE_SHELL = 2853;
+	private static final int EN_STONEGOLEM_POWDER = 2854;
+	private static final int EN_IRONGOLEM_SCRAP = 2855;
+	private static final int TONE_OF_WATER = 2856;
+	private static final int TONE_OF_FIRE = 2857;
+	private static final int TONE_OF_WIND = 2858;
+	private static final int TONE_OF_EARTH = 2859;
+	private static final int SALAMANDER_CHARM = 2860;
+	private static final int SYLPH_CHARM = 2861;
+	private static final int UNDINE_CHARM = 2862;
+	private static final int SERPENT_CHARM = 2863;
+	
+	// Rewards
+	private static final int MARK_OF_MAGUS = 2840;
+	private static final int DIMENSIONAL_DIAMOND = 7562;
+	
+	// NPCs
+	private static final int PARINA = 30391;
+	private static final int EARTH_SNAKE = 30409;
+	private static final int FLAME_SALAMANDER = 30411;
+	private static final int WIND_SYLPH = 30412;
+	private static final int WATER_UNDINE = 30413;
+	private static final int CASIAN = 30612;
+	private static final int RUKAL = 30629;
+	
+	// Monsters
+	private static final int HARPY = 20145;
+	private static final int MARSH_STAKATO = 20157;
+	private static final int WYRM = 20176;
+	private static final int MARSH_STAKATO_WORKER = 20230;
+	private static final int TOAD_LORD = 20231;
+	private static final int MARSH_STAKATO_SOLDIER = 20232;
+	private static final int MARSH_STAKATO_DRONE = 20234;
+	private static final int WINDSUS = 20553;
+	private static final int ENCHANTED_MONSTEREYE = 20564;
+	private static final int ENCHANTED_STONE_GOLEM = 20565;
+	private static final int ENCHANTED_IRON_GOLEM = 20566;
+	private static final int SINGING_FLOWER_PHANTASM = 27095;
+	private static final int SINGING_FLOWER_NIGHTMARE = 27096;
+	private static final int SINGING_FLOWER_DARKLING = 27097;
+	private static final int GHOST_FIRE = 27098;
+	
+	public Q228_TestOfMagus()
+	{
+		super(228, qn, "Test Of Magus");
+		
+		setItemsIds(RUKAL_LETTER, PARINA_LETTER, LILAC_CHARM, GOLDEN_SEED_1, GOLDEN_SEED_2, GOLDEN_SEED_3, SCORE_OF_ELEMENTS, DAZZLING_DROP, FLAME_CRYSTAL, HARPY_FEATHER, WYRM_WINGBONE, WINDSUS_MANE, EN_MONSTEREYE_SHELL, EN_STONEGOLEM_POWDER, EN_IRONGOLEM_SCRAP, TONE_OF_WATER, TONE_OF_FIRE, TONE_OF_WIND, TONE_OF_EARTH, SALAMANDER_CHARM, SYLPH_CHARM, UNDINE_CHARM, SERPENT_CHARM);
+		
+		addStartNpc(RUKAL);
+		addTalkId(PARINA, EARTH_SNAKE, FLAME_SALAMANDER, WIND_SYLPH, WATER_UNDINE, CASIAN, RUKAL);
+		
+		addKillId(HARPY, MARSH_STAKATO, WYRM, MARSH_STAKATO_WORKER, TOAD_LORD, MARSH_STAKATO_SOLDIER, MARSH_STAKATO_DRONE, WINDSUS, ENCHANTED_MONSTEREYE, ENCHANTED_STONE_GOLEM, ENCHANTED_IRON_GOLEM, SINGING_FLOWER_PHANTASM, SINGING_FLOWER_NIGHTMARE, SINGING_FLOWER_DARKLING, GHOST_FIRE);
+	}
+	
+	@Override
+	public String onAdvEvent(String event, L2Npc npc, L2PcInstance player)
+	{
+		String htmltext = event;
+		QuestState st = player.getQuestState(qn);
+		if (st == null)
+			return htmltext;
+		
+		// RUKAL
+		if (event.equalsIgnoreCase("30629-04a.htm"))
+		{
+			st.setState(STATE_STARTED);
+			st.set("cond", "1");
+			st.playSound(QuestState.SOUND_ACCEPT);
+			st.giveItems(DIMENSIONAL_DIAMOND, 122);
+			st.giveItems(RUKAL_LETTER, 1);
+		}
+		else if (event.equalsIgnoreCase("30629-10.htm"))
+		{
+			st.set("cond", "5");
+			st.playSound(QuestState.SOUND_MIDDLE);
+			st.takeItems(GOLDEN_SEED_1, 1);
+			st.takeItems(GOLDEN_SEED_2, 1);
+			st.takeItems(GOLDEN_SEED_3, 1);
+			st.takeItems(LILAC_CHARM, 1);
+			st.giveItems(SCORE_OF_ELEMENTS, 1);
+		}
+		// PARINA
+		else if (event.equalsIgnoreCase("30391-02.htm"))
+		{
+			st.set("cond", "2");
+			st.playSound(QuestState.SOUND_MIDDLE);
+			st.takeItems(RUKAL_LETTER, 1);
+			st.giveItems(PARINA_LETTER, 1);
+		}
+		// CASIAN
+		else if (event.equalsIgnoreCase("30612-02.htm"))
+		{
+			st.set("cond", "3");
+			st.playSound(QuestState.SOUND_MIDDLE);
+			st.takeItems(PARINA_LETTER, 1);
+			st.giveItems(LILAC_CHARM, 1);
+		}
+		// WIND SYLPH
+		else if (event.equalsIgnoreCase("30412-02.htm"))
+			st.giveItems(SYLPH_CHARM, 1);
+		// EARTH SNAKE
+		else if (event.equalsIgnoreCase("30409-03.htm"))
+			st.giveItems(SERPENT_CHARM, 1);
+		
+		return htmltext;
+	}
+	
+	@Override
+	public String onTalk(L2Npc npc, L2PcInstance player)
+	{
+		String htmltext = getNoQuestMsg();
+		QuestState st = player.getQuestState(qn);
+		if (st == null)
+			return htmltext;
+		
+		switch (st.getState())
+		{
+			case STATE_CREATED:
+				if (player.getClassId() != ClassId.wizard && player.getClassId() != ClassId.elvenWizard && player.getClassId() != ClassId.darkWizard)
+					htmltext = "30629-01.htm";
+				else if (player.getLevel() < 39)
+					htmltext = "30629-02.htm";
+				else
+					htmltext = "30629-03.htm";
+				break;
+			
+			case STATE_STARTED:
+				int cond = st.getInt("cond");
+				switch (npc.getNpcId())
+				{
+					case RUKAL:
+						if (cond == 1)
+							htmltext = "30629-05.htm";
+						else if (cond == 2)
+							htmltext = "30629-06.htm";
+						else if (cond == 3)
+							htmltext = "30629-07.htm";
+						else if (cond == 4)
+							htmltext = "30629-08.htm";
+						else if (cond == 5)
+							htmltext = "30629-11.htm";
+						else if (cond == 6)
+						{
+							htmltext = "30629-12.htm";
+							st.takeItems(SCORE_OF_ELEMENTS, 1);
+							st.takeItems(TONE_OF_EARTH, 1);
+							st.takeItems(TONE_OF_FIRE, 1);
+							st.takeItems(TONE_OF_WATER, 1);
+							st.takeItems(TONE_OF_WIND, 1);
+							st.giveItems(MARK_OF_MAGUS, 1);
+							st.rewardExpAndSp(139039, 40000);
+							player.broadcastPacket(new SocialAction(player, 3));
+							st.playSound(QuestState.SOUND_FINISH);
+							st.exitQuest(false);
+						}
+						break;
+					
+					case PARINA:
+						if (cond == 1)
+							htmltext = "30391-01.htm";
+						else if (cond == 2)
+							htmltext = "30391-03.htm";
+						else if (cond == 3 || cond == 4)
+							htmltext = "30391-04.htm";
+						else if (cond > 4)
+							htmltext = "30391-05.htm";
+						break;
+					
+					case CASIAN:
+						if (cond == 2)
+							htmltext = "30612-01.htm";
+						else if (cond == 3)
+							htmltext = "30612-03.htm";
+						else if (cond == 4)
+							htmltext = "30612-04.htm";
+						else if (cond > 4)
+							htmltext = "30612-05.htm";
+						break;
+					
+					case WATER_UNDINE:
+						if (cond == 5)
+						{
+							if (st.hasQuestItems(UNDINE_CHARM))
+							{
+								if (st.getQuestItemsCount(DAZZLING_DROP) < 20)
+									htmltext = "30413-02.htm";
+								else
+								{
+									htmltext = "30413-03.htm";
+									st.takeItems(DAZZLING_DROP, 20);
+									st.takeItems(UNDINE_CHARM, 1);
+									st.giveItems(TONE_OF_WATER, 1);
+									if (st.hasQuestItems(TONE_OF_FIRE, TONE_OF_WIND, TONE_OF_EARTH))
+									{
+										st.set("cond", "6");
+										st.playSound(QuestState.SOUND_MIDDLE);
+									}
+								}
+							}
+							else if (!st.hasQuestItems(TONE_OF_WATER))
+							{
+								htmltext = "30413-01.htm";
+								st.giveItems(UNDINE_CHARM, 1);
+							}
+							else
+								htmltext = "30413-04.htm";
+						}
+						else if (cond == 6)
+							htmltext = "30413-04.htm";
+						break;
+					
+					case FLAME_SALAMANDER:
+						if (cond == 5)
+						{
+							if (st.hasQuestItems(SALAMANDER_CHARM))
+							{
+								if (st.getQuestItemsCount(FLAME_CRYSTAL) < 5)
+									htmltext = "30411-02.htm";
+								else
+								{
+									htmltext = "30411-03.htm";
+									st.takeItems(FLAME_CRYSTAL, 5);
+									st.takeItems(SALAMANDER_CHARM, 1);
+									st.giveItems(TONE_OF_FIRE, 1);
+									if (st.hasQuestItems(TONE_OF_WATER, TONE_OF_WIND, TONE_OF_EARTH))
+									{
+										st.set("cond", "6");
+										st.playSound(QuestState.SOUND_MIDDLE);
+									}
+								}
+							}
+							else if (!st.hasQuestItems(TONE_OF_FIRE))
+							{
+								htmltext = "30411-01.htm";
+								st.giveItems(SALAMANDER_CHARM, 1);
+							}
+							else
+								htmltext = "30411-04.htm";
+						}
+						else if (cond == 6)
+							htmltext = "30411-04.htm";
+						break;
+					
+					case WIND_SYLPH:
+						if (cond == 5)
+						{
+							if (st.hasQuestItems(SYLPH_CHARM))
+							{
+								if (st.getQuestItemsCount(HARPY_FEATHER) + st.getQuestItemsCount(WYRM_WINGBONE) + st.getQuestItemsCount(WINDSUS_MANE) < 40)
+									htmltext = "30412-03.htm";
+								else
+								{
+									htmltext = "30412-04.htm";
+									st.takeItems(HARPY_FEATHER, 20);
+									st.takeItems(SYLPH_CHARM, 1);
+									st.takeItems(WINDSUS_MANE, 10);
+									st.takeItems(WYRM_WINGBONE, 10);
+									st.giveItems(TONE_OF_WIND, 1);
+									if (st.hasQuestItems(TONE_OF_WATER, TONE_OF_FIRE, TONE_OF_EARTH))
+									{
+										st.set("cond", "6");
+										st.playSound(QuestState.SOUND_MIDDLE);
+									}
+								}
+							}
+							else if (!st.hasQuestItems(TONE_OF_WIND))
+								htmltext = "30412-01.htm";
+							else
+								htmltext = "30412-05.htm";
+						}
+						else if (cond == 6)
+							htmltext = "30412-05.htm";
+						break;
+					
+					case EARTH_SNAKE:
+						if (cond == 5)
+						{
+							if (st.hasQuestItems(SERPENT_CHARM))
+							{
+								if (st.getQuestItemsCount(EN_MONSTEREYE_SHELL) + st.getQuestItemsCount(EN_STONEGOLEM_POWDER) + st.getQuestItemsCount(EN_IRONGOLEM_SCRAP) < 30)
+									htmltext = "30409-04.htm";
+								else
+								{
+									htmltext = "30409-05.htm";
+									st.takeItems(EN_IRONGOLEM_SCRAP, 10);
+									st.takeItems(EN_MONSTEREYE_SHELL, 10);
+									st.takeItems(EN_STONEGOLEM_POWDER, 10);
+									st.takeItems(SERPENT_CHARM, 1);
+									st.giveItems(TONE_OF_EARTH, 1);
+									if (st.hasQuestItems(TONE_OF_WATER, TONE_OF_FIRE, TONE_OF_WIND))
+									{
+										st.set("cond", "6");
+										st.playSound(QuestState.SOUND_MIDDLE);
+									}
+								}
+							}
+							else if (!st.hasQuestItems(TONE_OF_EARTH))
+								htmltext = "30409-01.htm";
+							else
+								htmltext = "30409-06.htm";
+						}
+						else if (cond == 6)
+							htmltext = "30409-06.htm";
+						break;
+				}
+				break;
+			
+			case STATE_COMPLETED:
+				htmltext = getAlreadyCompletedMsg();
+				break;
+		}
+		
+		return htmltext;
+	}
+	
+	@Override
+	public String onKill(L2Npc npc, L2PcInstance player, boolean isPet)
+	{
+		QuestState st = checkPlayerState(player, npc, STATE_STARTED);
+		if (st == null)
+			return null;
+		
+		int cond = st.getInt("cond");
+		
+		if (cond == 3)
+		{
+			switch (npc.getNpcId())
+			{
+				case SINGING_FLOWER_PHANTASM:
+					if (!st.hasQuestItems(GOLDEN_SEED_1))
+					{
+						npc.broadcastNpcSay("I am a tree of nothing... a tree... that knows where to return...");
+						st.dropItemsAlways(GOLDEN_SEED_1, 1, 1);
+						if (st.hasQuestItems(GOLDEN_SEED_2, GOLDEN_SEED_3))
+							st.set("cond", "4");
+					}
+					break;
+				
+				case SINGING_FLOWER_NIGHTMARE:
+					if (!st.hasQuestItems(GOLDEN_SEED_2))
+					{
+						npc.broadcastNpcSay("I am a creature that shows the truth of the place deep in my heart...");
+						st.dropItemsAlways(GOLDEN_SEED_2, 1, 1);
+						if (st.hasQuestItems(GOLDEN_SEED_1, GOLDEN_SEED_3))
+							st.set("cond", "4");
+					}
+					break;
+				
+				case SINGING_FLOWER_DARKLING:
+					if (!st.hasQuestItems(GOLDEN_SEED_3))
+					{
+						npc.broadcastNpcSay("I am a mirror of darkness... a virtual image of darkness...");
+						st.dropItemsAlways(GOLDEN_SEED_3, 1, 1);
+						if (st.hasQuestItems(GOLDEN_SEED_1, GOLDEN_SEED_2))
+							st.set("cond", "4");
+					}
+					break;
+			}
+		}
+		else if (cond == 5)
+		{
+			switch (npc.getNpcId())
+			{
+				case GHOST_FIRE:
+					if (st.hasQuestItems(SALAMANDER_CHARM))
+						st.dropItems(FLAME_CRYSTAL, 1, 5, 500000);
+					break;
+				
+				case TOAD_LORD:
+				case MARSH_STAKATO:
+				case MARSH_STAKATO_WORKER:
+					if (st.hasQuestItems(UNDINE_CHARM))
+						st.dropItems(DAZZLING_DROP, 1, 20, 300000);
+					break;
+				
+				case MARSH_STAKATO_SOLDIER:
+					if (st.hasQuestItems(UNDINE_CHARM))
+						st.dropItems(DAZZLING_DROP, 1, 20, 400000);
+					break;
+				
+				case MARSH_STAKATO_DRONE:
+					if (st.hasQuestItems(UNDINE_CHARM))
+						st.dropItems(DAZZLING_DROP, 1, 20, 500000);
+					break;
+				
+				case HARPY:
+					if (st.hasQuestItems(SYLPH_CHARM))
+						st.dropItemsAlways(HARPY_FEATHER, 1, 20);
+					break;
+				
+				case WYRM:
+					if (st.hasQuestItems(SYLPH_CHARM))
+						st.dropItems(WYRM_WINGBONE, 1, 10, 500000);
+					break;
+				
+				case WINDSUS:
+					if (st.hasQuestItems(SYLPH_CHARM))
+						st.dropItems(WINDSUS_MANE, 1, 10, 500000);
+					break;
+				
+				case ENCHANTED_MONSTEREYE:
+					if (st.hasQuestItems(SERPENT_CHARM))
+						st.dropItemsAlways(EN_MONSTEREYE_SHELL, 1, 10);
+					break;
+				
+				case ENCHANTED_STONE_GOLEM:
+					if (st.hasQuestItems(SERPENT_CHARM))
+						st.dropItemsAlways(EN_STONEGOLEM_POWDER, 1, 10);
+					break;
+				
+				case ENCHANTED_IRON_GOLEM:
+					if (st.hasQuestItems(SERPENT_CHARM))
+						st.dropItemsAlways(EN_IRONGOLEM_SCRAP, 1, 10);
+					break;
+			}
+		}
+		
+		return null;
+	}
+	
+	public static void main(String[] args)
+	{
+		new Q228_TestOfMagus();
+	}
+}
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-07.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-07.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-07.htm	(revision 342)
@@ -0,0 +1,4 @@
+<html><body>Bard Rukal:<br>
+The Singing Flowers must be stopped from ever singing that song again. You must find them all and destroy them. You can obtain golden seeds when you destroy them.
+You must get 3 types of seeds from 3 different types of Singing Flowers.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-08.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-08.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-08.htm	(revision 342)
@@ -0,0 +1,6 @@
+<html><body>Bard Rukal:<br>
+Excellent! The Golden Seeds of the Singing Flower!<br>
+I have experience raising flowers from these seeds. One must be very careful in their cultivation, they can grow into brutal flowers if the seeds taste living human blood. Under normal circumstances they grow into a beautiful flower called 'Millennium Flower.' To grow these you must be able to produce the exquisite 'Absolute Tone'.<br>
+The problem is that I cannot produce absolute tone with my skills... Would you be willing to help me once you start your job?<br>
+<a action="bypass -h Quest Q228_TestOfMagus 30629-09.htm">Say you will help</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-09.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-09.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-09.htm	(revision 342)
@@ -0,0 +1,6 @@
+<html><body>Bard Rukal:<br>
+To make an Absolute Tone we need 4 tones that correspond to 4 elements. As you know, our world is composed of these 4 elements and the 4 tones represent the essence of each element.<br>
+That is, we can only make the Absolute Tone which controls all other tones by collecting 4 notes that correspond to the 4 elements.<br>
+Remember, collecting these 4 tones is a difficult, time-consuming task..<br>
+<a action="bypass -h Quest Q228_TestOfMagus 30629-10.htm">Ask about 4 notes</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30412-01.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30412-01.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30412-01.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Wind Sylph:<br>
+Nice to meet you, Elder of the magical world, manager of the elements. I am the Wind Sylph, messenger of Zephyr, guide of the storms. Have you come to me seeking the Tone of Wind, by any chance?<br>
+The wind is an elusive figure, hard to grasp... Do you believe that you can get a note consisting of this wind? Only I can give the Tone of Wind. You must make a deal with me.<br>
+<a action="bypass -h Quest Q228_TestOfMagus 30412-02.htm">"I will make a deal with you."</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30412-02.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30412-02.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30412-02.htm	(revision 342)
@@ -0,0 +1,4 @@
+<html><body>Wind Sylph:<br>
+Ah yes, a wise choice... Bring me 20 Harpy Feathers, 10 wyrm wingbones, and 10 Windsus Manes... You will find your prey in the Gorgon Flower Garden in Giran and Death Pass.<br>
+Do you understand? The harpy flies by gliding on the wind, the wyrm's feathers blast the wind mightily and the mane of the windsus blows in the wind. As you see, these creatures all have the wind in common, which I must control...
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30612-01.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30612-01.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30612-01.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Elder Casian:<br>
+I have heard of Parina's suffering because of that monstrous flower ... I have thought of nothing else for days... The only solution I can come up with is to hunt down the vicious flower and kill it.<br>
+I have heard that there are actually 3 flowers: The nightmare singing flower, the phantom singing flower and the darkness singing flower. We must find all 3 of them.<br>
+<a action="bypass -h Quest Q228_TestOfMagus 30612-02.htm">"Where are the singing flowers?"</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30412-03.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30412-03.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30412-03.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Wind Sylph:<br>
+Is the wind blowing in your mind as well? Are all your memories blown away? 20 Harpy Feathers, 10 Wyrm Wingbone, and 10 Windsus Manes... If you do not bring these 3 materials, I will not give you the Tone of Wind.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30612-02.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30612-02.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30612-02.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Elder Casian:<br>
+The singing flowers are said to bloom near waterfalls or lakes, and seduce passersby with their beautiful voice. Different kinds of singing flowers will never bloom close to each other.<br>
+Parina, Rukal and I searched for them and managed to agree on a few places. We are sure the flowers may be found near the Fellmere Lake in Gludio, the waterfalls near the Ivory Tower of Oren, and somewhere in the southern part of the Town of Giran.<br>
+Got that? The flowers bloom near water. You must look in the 3 places I mentioned, especially near water. You must be very careful because the singing flowers all possess small amounts of poison... Take this amulet with you, it will help.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30412-04.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30412-04.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30412-04.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Wind Sylph:<br>
+...You have gathered all of them! You are faithful indeed... Even the wind keeps its promises. Take this Tone of Wind... Be careful, because it might blow away...
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30612-03.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30612-03.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30612-03.htm	(revision 342)
@@ -0,0 +1,4 @@
+<html><body>Elder Casian:<br>
+You still haven't found all the seeds... What are you doing? Hurry, go and find all 3! If this mission is too much for you, then give up!<br>
+If you intend to complete the task, you must go to the Fellmere Lake in Gludio, the waterfalls near the Ivory Tower of Oren, and the southern part of the Town of Giran, kill the flowers and bring back the seeds! You got it?
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30412-05.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30412-05.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30412-05.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Wind Sylph:<br>
+Are you taking good care of the Tone of Wind? That thing can be easily swept away, so hold on to it firmly. Once you lose it, you will never hear its beautiful melody again.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30612-04.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30612-04.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30612-04.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Elder Casian:<br>
+Ah, all the seeds! Good, good...! You may go now. Take this to Bard Rukal.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30612-05.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30612-05.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30612-05.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Elder Casian:<br>
+The note of the element? Even I, an esteemed Sage, have never heard such a thing... Well, I must admit that I have heard of their stunning beauty...
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30391-01.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30391-01.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30391-01.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Parina:<br>
+So you heard that song as well. Yes, I've been hearing that melody every night recently. I've heard many types of music, and am quite sure this is not a Human voice.<br>
+It seemed to emanate from all directions. Near and far away at the same time... Perhaps it was the voice of the 'singing flower'...<br>
+<a action="bypass -h Quest Q228_TestOfMagus 30391-02.htm">Ask about the singing flower</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30391-02.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30391-02.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30391-02.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Parina:<br>
+The singing flower is an infamous evil spirit which sings when in bloom. It looks like a beautiful woman but is actually quite a dreadful creature. They sprout from a pod called 'the Golden Seed'.<br>
+The singing flower is said to seduce people with its beautiful voice, only to later feed on their blood...<br>
+I have consulted Elder Casian about this matter, why don't you take this letter and go and meet him. He is in the Wastelands.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30391-03.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30391-03.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30391-03.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Parina:<br>
+You are still here? You must go and meet Elder Casian immediately. He knows more than anyone else about the singing flower.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30391-04.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30391-04.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30391-04.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Parina:<br>
+You must not be swayed by the voice of the singing flower. They are vile creatures that should be exterminated from the earth. Find them and kill them all. Then you must locate the Golden Seed which bears the blood of the innocent. When you find 3 of them take them to Bard Rukal.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30391-05.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30391-05.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30391-05.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Parina:<br>
+So, I understand that you seek the notes of the 4 elements for Rukal? I wish you luck in gathering all the notes and completing the absolute tone.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-10.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-10.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-10.htm	(revision 342)
@@ -0,0 +1,8 @@
+<html><body>Bard Rukal:<br>
+You must collect the 4 tones that correspond to the 4 elements in order to create an Absolute Tone.<br>
+To obtain the Note of Water you must visit the Water Undine, a water spirit who lives in Fellmere Lake... It is located northwest of Gludin, north of the Abandoned Camp.<br>
+To obtain the Note of Fire you must seek the Flame Salamander. Lizard spirits such as this salamander are formed with the power of flame. They can be found in the Ruins of Despair, south of the Town of Gludio.<br>
+To locate the Note of Wind you must meet the Wind Sylph. She is on the northwest side of the 3 entrances to the Wastelands of Gludio.<br>
+Last, the Note of Earth can be obtained from the Earth Snake. He is in the Ruins of Agony, on the north side of the Town of Gludio.<br>
+I will give you a musical book in which to put the 4 notes. When you have found them all return the book to me.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-11.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-11.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-11.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Bard Rukal:<br>
+The Test of the Magus will not be complete until all 4 tones essential for Absolute Tone are collected. Please do your best to get these tones for me.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-12.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-12.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30629-12.htm	(revision 342)
@@ -0,0 +1,4 @@
+<html><body>Bard Rukal:<br>
+Congratulations! You have passed the Test of the Magus! Now I can start the time-consuming process of creating Absolute Tone. This would not have been possible without your efforts. I will let you know when the Millennium Flowers bloom. Come to see me then.<br>
+Congratulations again on passing the test! I shall grant you the Mark of the Magus.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30411-01.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30411-01.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30411-01.htm	(revision 342)
@@ -0,0 +1,6 @@
+<html><body>Flame Salamander:<br>
+What is it, my child? Have you no fear of fire?<br>
+...Ah, you seek the Note of Fire... I see...<br>
+Of course I have it, silly! Nothing comes for free, however...<br>
+If you will journey north, near the Ivory Tower, and retrieve 5 Flame Crystals from the Ghost Fires, I shall take them in exchange for the Note of Fire! But not one less than 5!
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30411-02.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30411-02.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q228_TestOfMagus/30411-02.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Flame Salamander:<br>
+Bring me 5 Flame Crystals from the Ghost Fires. They are in the north... Near the Ivory Tower...
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30702-01.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30702-01.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30702-01.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Guild President Bernard:<br>
+Sagittarians are those who are known as the best bowmen of this kingdom. A hundred years ago, when the dragon Lindvior attacked Castle Aden, a bowman named Atlanta shot an arrow right through the dragon's eye. For this he was given the first title as a Sagittarius. Right now there are just 33 Sagittarians in the world.<br>
+If you want to be recognized as an exemplary bowman, you may take the <font color="LEVEL">Test of Sagittarius</font> and prove your ability. Many hunters and bowmen have taken the test this year and failed. You must be well above average to pass this test... I heard that you are skillful but as I see it, from the perpective of a Guild President... You are not good enough. Train some more before you come back.<br>
+(Quest for Rogues, Elven Scouts and Assassins, level 39 and above.)
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30702-02.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30702-02.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30702-02.htm	(revision 342)
@@ -0,0 +1,4 @@
+<html><body>Guild President Bernard:<br>
+Do you have any idea of what the <font color="LEVEL">Test of the Sagittarius</font> is? Only Humans may take this test. Why are you here with an arrow? You'll only make yourself a laughingstock...<br>
+(Quest for Rogues, Elven Scouts and Assassins, level 39 and above.)
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30514-01.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30514-01.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30514-01.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Prefect Vokian:<br>
+So, you work for Hamil! He saved my life in a battle with the medusas... I can't deny him anything...<br>
+Recently someone who called himself Hunter Brankel came to me and asked for help. He knew quite a bit about the Breka Orcs... When he left he set off for the campsite of the Breka tribe.<br>
+<a action="bypass -h Quest Q224_TestOfSagittarius 30514-02.htm">Explain the situation</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30702-03.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30702-03.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30702-03.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Guild President Bernard:<br>
+Sagittarians are those who are known as the best bowmen in this kingdom. A hundred years ago, when the Gold Dragon Lindvior attacked Castle Aden, a bowman by the name of Atlanta shot an arrow right through the dragon's eye. For this he was given the first title as a Sagittarius. At the moment there are just 33 Sagittarians in the world.<br>
+If you wish to be recognized as an exemplary bowman, you may take the <font color="LEVEL">Test of the Sagittarius</font> and prove your ability. Many hunters and bowmen took the test this year, and all failed. I warn you, if your skills are not good enough to shoot down a flying eagle, you might as well not even try.<br>
+<a action="bypass -h Quest Q224_TestOfSagittarius 30702-04a.htm">I will take the test.</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30514-02.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30514-02.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30514-02.htm	(revision 342)
@@ -0,0 +1,6 @@
+<html><body>Prefect Vokian:<br>
+Breka Orcs! Those filthy betrayers degrade the dignity of Orcs! They should all be sent to hell painfully!<br>
+You say that the Breka tribe has been given the serpent's egg from the devil's nest? Yes, that stands to reason as their totem was a coiled serpent...<br>
+Seer Manakia tells me that the Breka Orcs are preparing for a big ceremony right now... Perhaps the serpent's egg has something to do with it!<br>
+Please, you must go there, find out whatever you can and then kill every single <font color="LEVEL">Chief and Shaman of the Breka Orcs</font>! If you can find a <font color="LEVEL">Serpent-Shaped Charm</font>, bring it back to me.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30702-04.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30702-04.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30702-04.htm	(revision 342)
@@ -0,0 +1,4 @@
+<html><body>Guild President Bernard:<br>
+Hmm... All right, you may try. First go and meet <font color="LEVEL">Hamil of Floran Village</font>. He is originally from Innadril. He is a genius of archery, who received the title of Sagittarius at the age of 20. He has instructed many archers twice his age!<br>
+Ha! To tell you the truth, it is more important for you to win Hamil's approval rather than mine for the test. Take this Letter of Introduction to him. Hamil will have a task for you. Perform it well, young one. May the joy of the chase and the reward of the hunt be with you!
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30514-03.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30514-03.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30514-03.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Prefect Vokian:<br>
+Mercy is a luxury that filthy betrayers can ill afford! The <font color="LEVEL">Chiefs and Magisters of Breka Orcs</font> are the ringleaders of the corruption! You should be able to extract some information from them! If you should find <font color="LEVEL">a snake-shaped amulet</font> please bring it to me!
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30702-05.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30702-05.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30702-05.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Guild President Bernard:<br>
+As I said, you must see <font color="LEVEL">Hamil of Floran Village</font> if you wish to receive the Mark of the Sagittarius.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30702-04a.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30702-04a.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30702-04a.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Hunters Guild President Bernard:<br>
+Hmmm . . . well, go ahead and try. My advice is to first visit <font color="LEVEL">Hamil from Floran Village</font>. He is a native of Innadril and an amazing archer -- he earned the nickname Sagittarius before he was even out of his teens. In fact, much more experienced archers even used to come to him for training.<br>
+To pass this test, you must impress Hamil. Take this introduction letter to him and he will tell you what task to perform. Good luck, youngster. May the joy of the hunt be with you!<br>
+Before you set off, accept this <font color="LEVEL">Dimension Diamond</font>. You can trade it for something special from the village gatekeeper. I'm sure it prove helpful to you on your journey.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30514-04.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30514-04.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30514-04.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Prefect Vokian:<br>
+This amulet will summon the spirits of the totem! Could those filthy Breka Orcs be trying to revive their long-dead totem spirit?<br>
+Those foolish pigs have been deceived by the heathens into believing that hatching the devil serpent will restore the spirit of their totem!<br>
+I know that Brankel would not have gone along with this. Could these runes be a message from him? I can't read this, but Hamil knows it well. Take it to him. I wish you luck!
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30653-01.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30653-01.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30653-01.htm	(revision 342)
@@ -0,0 +1,4 @@
+<html><body>Sir Aron Tanford:<br>
+Nice to meet you, young Warrior. I am Aron Tanford, watchdog of the Wastelands. My mission is to stop the brutes that are terrorizing the villagers...<br>
+<a action="bypass -h Quest Q224_TestOfSagittarius 30653-02.htm">Show him the letter from Hamil</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30514-05.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30514-05.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30514-05.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Prefect Vokian:<br>
+Please tell Hamil that I wish to see him again on the battlefield. I cannot repay my debt to him this way.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-10.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-10.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-10.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Sagittarius Hamil:<br>
+No one has more experience against Commander Kadesh than <font color="LEVEL">Magister Gauen</font> of the <font color="LEVEL">Ivory Tower</font>. His assistance is essential. Go and meet him now.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30653-02.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30653-02.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30653-02.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Sir Aron Tanford:<br>
+About 10 days ago, two travelers entered the Wastelands claiming they had come to excavate artifacts of the empirical era. Although I doubted their story I didn't stop them. When I spoke with Hunter Brankel a few days later, I realized that I had made a grave mistake. They were not archaeologists, but a bunch of ravenous heathens!<br>
+As you know, the castle of the evil Beleth once stood where the Wastelands are now. I am sure these heathens seek the remains of that devil! Brankel went to the <font color="LEVEL">Ant's Nest of the Wastelands</font> to try to determine their motives. I haven't heard from him since...<br>
+I am sorry but this is all I know.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-11.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-11.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-11.htm	(revision 342)
@@ -0,0 +1,6 @@
+<html><body>Sagittarius Hamil:<br>
+Brankel lives! I met with him shortly before he left for the south of Oren.<font color="LEVEL"> Commander Kadesh</font> is currently surviving off the flesh of Leto Lizardmen.<br>
+Dammit! I should've gone with Brankel!<br>
+Oh! Look! The crescent bow! I haven't seen it in 20 years! Take it and follow Brankel! Kill the <font color="LEVEL">Leto Lizardmen</font> and Kadesh will appear! Kill him with the crescent bow!<br>
+<font color="LEVEL">You mustn't use any other method or skill, or the power of the bow will disappear and Kadesh will survive</font>!
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30653-03.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30653-03.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30653-03.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Sir Aron Tanford:<br>
+I fear for Hunter Brankel, but what worries me more is what those heathen may do with the remains of Beleth... I must stay here, so I beseech you, go to the <font color="LEVEL">Ant's Nest of the Wastelands</font> and find out what is going on there.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-12.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-12.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-12.htm	(revision 342)
@@ -0,0 +1,4 @@
+<html><body>Sagittarius Hamil:<br>
+As time passes, <font color="LEVEL">Commander Kadesh</font> grows stronger. Kill his food source, the <font color="LEVEL">Leto Lizardmen</font>. When Kadesh appears, kill him with the <font color="LEVEL">crescent bow</font>! If you use a skill or another method, the power of the bow will disappear and <font color="LEVEL">Kadesh will survive</font>!<br>
+Don't forget! <font color="LEVEL">Never use a skill to kill Kadesh!</font>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-13.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-13.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-13.htm	(revision 342)
@@ -0,0 +1,6 @@
+<html><body>Sagittarius Hamil:<br>
+So you haven't found Brankel... He is searching for the heathens? He is noble indeed. He was correct, they must be up to something else. <font color="LEVEL">Commander Kadesh</font> is not their final goal...<br>
+This amulet holds clues for us... The seven eyes... This is the mark of the children of Shilen. I must report this to the hunter's union immediately. I will also return the crescent bow to the Ivory Tower of Oren.<br>
+Thank you for your help. You have done more in this matter than Brankel or myself...<br>
+You are a Sagittarius. Take this <font color="LEVEL">Mark of Sagittarius</font>. I hope that we shall hunt together sometime in the future.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/Q224_TestOfSagittarius.java
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/Q224_TestOfSagittarius.java	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/Q224_TestOfSagittarius.java	(revision 342)
@@ -0,0 +1,364 @@
+/*
+ * This program is free software: you can redistribute it and/or modify it under
+ * the terms of the GNU General Public License as published by the Free Software
+ * Foundation, either version 3 of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful, but WITHOUT
+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
+ * FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along with
+ * this program. If not, see <http://www.gnu.org/licenses/>.
+ */
+package quests.Q224_TestOfSagittarius;
+
+import net.sf.l2j.gameserver.model.actor.L2Npc;
+import net.sf.l2j.gameserver.model.actor.instance.L2PcInstance;
+import net.sf.l2j.gameserver.model.base.ClassId;
+import net.sf.l2j.gameserver.model.itemcontainer.Inventory;
+import net.sf.l2j.gameserver.model.quest.Quest;
+import net.sf.l2j.gameserver.model.quest.QuestState;
+import net.sf.l2j.gameserver.network.serverpackets.SocialAction;
+import net.sf.l2j.util.Rnd;
+
+public class Q224_TestOfSagittarius extends Quest
+{
+	private static final String qn = "Q224_TestOfSagittarius";
+	
+	// Items
+	private static final int BERNARD_INTRODUCTION = 3294;
+	private static final int HAMIL_LETTER_1 = 3295;
+	private static final int HAMIL_LETTER_2 = 3296;
+	private static final int HAMIL_LETTER_3 = 3297;
+	private static final int HUNTER_RUNE_1 = 3298;
+	private static final int HUNTER_RUNE_2 = 3299;
+	private static final int TALISMAN_OF_KADESH = 3300;
+	private static final int TALISMAN_OF_SNAKE = 3301;
+	private static final int MITHRIL_CLIP = 3302;
+	private static final int STAKATO_CHITIN = 3303;
+	private static final int REINFORCED_BOWSTRING = 3304;
+	private static final int MANASHEN_HORN = 3305;
+	private static final int BLOOD_OF_LIZARDMAN = 3306;
+	
+	private static final int CRESCENT_MOON_BOW = 3028;
+	private static final int WOODEN_ARROW = 17;
+	
+	// Rewards
+	private static final int MARK_OF_SAGITTARIUS = 3293;
+	private static final int DIMENSIONAL_DIAMOND = 7562;
+	
+	// NPCs
+	private static final int BERNARD = 30702;
+	private static final int HAMIL = 30626;
+	private static final int SIR_ARON_TANFORD = 30653;
+	private static final int VOKIAN = 30514;
+	private static final int GAUEN = 30717;
+	
+	// Monsters
+	private static final int ANT = 20079;
+	private static final int ANT_CAPTAIN = 20080;
+	private static final int ANT_OVERSEER = 20081;
+	private static final int ANT_RECRUIT = 20082;
+	private static final int ANT_PATROL = 20084;
+	private static final int ANT_GUARD = 20086;
+	private static final int NOBLE_ANT = 20089;
+	private static final int NOBLE_ANT_LEADER = 20090;
+	private static final int BREKA_ORC_SHAMAN = 20269;
+	private static final int BREKA_ORC_OVERLORD = 20270;
+	private static final int MARSH_STAKATO_WORKER = 20230;
+	private static final int MARSH_STAKATO_SOLDIER = 20232;
+	private static final int MARSH_STAKATO_DRONE = 20234;
+	private static final int MARSH_SPIDER = 20233;
+	private static final int ROAD_SCAVENGER = 20551;
+	private static final int MANASHEN_GARGOYLE = 20563;
+	private static final int LETO_LIZARDMAN = 20577;
+	private static final int LETO_LIZARDMAN_ARCHER = 20578;
+	private static final int LETO_LIZARDMAN_SOLDIER = 20579;
+	private static final int LETO_LIZARDMAN_WARRIOR = 20580;
+	private static final int LETO_LIZARDMAN_SHAMAN = 20581;
+	private static final int LETO_LIZARDMAN_OVERLORD = 20582;
+	private static final int SERPENT_DEMON_KADESH = 27090;
+	
+	public Q224_TestOfSagittarius()
+	{
+		super(224, qn, "Test Of Sagittarius");
+		
+		setItemsIds(BERNARD_INTRODUCTION, HAMIL_LETTER_1, HAMIL_LETTER_2, HAMIL_LETTER_3, HUNTER_RUNE_1, HUNTER_RUNE_2, TALISMAN_OF_KADESH, TALISMAN_OF_SNAKE, MITHRIL_CLIP, STAKATO_CHITIN, REINFORCED_BOWSTRING, MANASHEN_HORN, BLOOD_OF_LIZARDMAN, CRESCENT_MOON_BOW);
+		
+		addStartNpc(BERNARD);
+		addTalkId(BERNARD, HAMIL, SIR_ARON_TANFORD, VOKIAN, GAUEN);
+		
+		addKillId(ANT, ANT_CAPTAIN, ANT_OVERSEER, ANT_RECRUIT, ANT_PATROL, ANT_GUARD, NOBLE_ANT, NOBLE_ANT_LEADER, BREKA_ORC_SHAMAN, BREKA_ORC_OVERLORD, MARSH_STAKATO_WORKER, MARSH_STAKATO_SOLDIER, MARSH_STAKATO_DRONE, MARSH_SPIDER, ROAD_SCAVENGER, MANASHEN_GARGOYLE, LETO_LIZARDMAN, LETO_LIZARDMAN_ARCHER, LETO_LIZARDMAN_SOLDIER, LETO_LIZARDMAN_WARRIOR, LETO_LIZARDMAN_SHAMAN, LETO_LIZARDMAN_OVERLORD, SERPENT_DEMON_KADESH);
+	}
+	
+	@Override
+	public String onAdvEvent(String event, L2Npc npc, L2PcInstance player)
+	{
+		String htmltext = event;
+		QuestState st = player.getQuestState(qn);
+		if (st == null)
+			return htmltext;
+		
+		// BERNARD
+		if (event.equalsIgnoreCase("30702-04a.htm"))
+		{
+			st.setState(STATE_STARTED);
+			st.set("cond", "1");
+			st.playSound(QuestState.SOUND_ACCEPT);
+			st.giveItems(BERNARD_INTRODUCTION, 1);
+			st.giveItems(DIMENSIONAL_DIAMOND, 96);
+		}
+		// HAMIL
+		else if (event.equalsIgnoreCase("30626-03.htm"))
+		{
+			st.set("cond", "2");
+			st.playSound(QuestState.SOUND_MIDDLE);
+			st.takeItems(BERNARD_INTRODUCTION, 1);
+			st.giveItems(HAMIL_LETTER_1, 1);
+		}
+		else if (event.equalsIgnoreCase("30626-07.htm"))
+		{
+			st.set("cond", "5");
+			st.playSound(QuestState.SOUND_MIDDLE);
+			st.takeItems(HUNTER_RUNE_1, 10);
+			st.giveItems(HAMIL_LETTER_2, 1);
+		}
+		// SIR_ARON_TANFORD
+		else if (event.equalsIgnoreCase("30653-02.htm"))
+		{
+			st.set("cond", "3");
+			st.playSound(QuestState.SOUND_MIDDLE);
+			st.takeItems(HAMIL_LETTER_1, 1);
+		}
+		// VOKIAN
+		else if (event.equalsIgnoreCase("30514-02.htm"))
+		{
+			st.set("cond", "6");
+			st.playSound(QuestState.SOUND_MIDDLE);
+			st.takeItems(HAMIL_LETTER_2, 1);
+		}
+		
+		return htmltext;
+	}
+	
+	@Override
+	public String onTalk(L2Npc npc, L2PcInstance player)
+	{
+		String htmltext = getNoQuestMsg();
+		QuestState st = player.getQuestState(qn);
+		if (st == null)
+			return htmltext;
+		
+		switch (st.getState())
+		{
+			case STATE_CREATED:
+				if (player.getClassId() != ClassId.rogue && player.getClassId() != ClassId.elvenScout && player.getClassId() != ClassId.assassin)
+					htmltext = "30702-02.htm";
+				else if (player.getLevel() < 39)
+					htmltext = "30702-01.htm";
+				else
+					htmltext = "30702-03.htm";
+				break;
+			
+			case STATE_STARTED:
+				int cond = st.getInt("cond");
+				switch (npc.getNpcId())
+				{
+					case BERNARD:
+						htmltext = "30702-05.htm";
+						break;
+					
+					case HAMIL:
+						if (cond == 1)
+							htmltext = "30626-01.htm";
+						else if (cond == 2 || cond == 3)
+							htmltext = "30626-04.htm";
+						else if (cond == 4)
+							htmltext = "30626-05.htm";
+						else if (cond > 4 && cond < 8)
+							htmltext = "30626-08.htm";
+						else if (cond == 8)
+						{
+							htmltext = "30626-09.htm";
+							st.set("cond", "9");
+							st.playSound(QuestState.SOUND_MIDDLE);
+							st.takeItems(HUNTER_RUNE_2, 10);
+							st.giveItems(HAMIL_LETTER_3, 1);
+						}
+						else if (cond > 8 && cond < 12)
+							htmltext = "30626-10.htm";
+						else if (cond == 12)
+						{
+							htmltext = "30626-11.htm";
+							st.set("cond", "13");
+							st.playSound(QuestState.SOUND_MIDDLE);
+						}
+						else if (cond == 13)
+							htmltext = "30626-12.htm";
+						else if (cond == 14)
+						{
+							htmltext = "30626-13.htm";
+							st.takeItems(BLOOD_OF_LIZARDMAN, -1);
+							st.takeItems(CRESCENT_MOON_BOW, 1);
+							st.takeItems(TALISMAN_OF_KADESH, 1);
+							st.giveItems(MARK_OF_SAGITTARIUS, 1);
+							st.rewardExpAndSp(54726, 20250);
+							player.broadcastPacket(new SocialAction(player, 3));
+							st.playSound(QuestState.SOUND_FINISH);
+							st.exitQuest(false);
+						}
+						break;
+					
+					case SIR_ARON_TANFORD:
+						if (cond == 2)
+							htmltext = "30653-01.htm";
+						else if (cond > 2)
+							htmltext = "30653-03.htm";
+						break;
+					
+					case VOKIAN:
+						if (cond == 5)
+							htmltext = "30514-01.htm";
+						else if (cond == 6)
+							htmltext = "30514-03.htm";
+						else if (cond == 7)
+						{
+							htmltext = "30514-04.htm";
+							st.set("cond", "8");
+							st.playSound(QuestState.SOUND_MIDDLE);
+							st.takeItems(TALISMAN_OF_SNAKE, 1);
+						}
+						else if (cond > 7)
+							htmltext = "30514-05.htm";
+						break;
+					
+					case GAUEN:
+						if (cond == 9)
+						{
+							htmltext = "30717-01.htm";
+							st.set("cond", "10");
+							st.playSound(QuestState.SOUND_MIDDLE);
+							st.takeItems(HAMIL_LETTER_3, 1);
+						}
+						else if (cond == 10)
+							htmltext = "30717-03.htm";
+						else if (cond == 11)
+						{
+							htmltext = "30717-02.htm";
+							st.set("cond", "12");
+							st.playSound(QuestState.SOUND_MIDDLE);
+							st.takeItems(MANASHEN_HORN, 1);
+							st.takeItems(MITHRIL_CLIP, 1);
+							st.takeItems(REINFORCED_BOWSTRING, 1);
+							st.takeItems(STAKATO_CHITIN, 1);
+							st.giveItems(CRESCENT_MOON_BOW, 1);
+							st.giveItems(WOODEN_ARROW, 10);
+						}
+						else if (cond > 11)
+							htmltext = "30717-04.htm";
+						break;
+				}
+				break;
+			
+			case STATE_COMPLETED:
+				htmltext = getAlreadyCompletedMsg();
+				break;
+		}
+		
+		return htmltext;
+	}
+	
+	@Override
+	public String onKill(L2Npc npc, L2PcInstance player, boolean isPet)
+	{
+		QuestState st = checkPlayerState(player, npc, STATE_STARTED);
+		if (st == null)
+			return null;
+		
+		switch (npc.getNpcId())
+		{
+			case ANT:
+			case ANT_CAPTAIN:
+			case ANT_OVERSEER:
+			case ANT_RECRUIT:
+			case ANT_PATROL:
+			case ANT_GUARD:
+			case NOBLE_ANT:
+			case NOBLE_ANT_LEADER:
+				if (st.getInt("cond") == 3 && st.dropItems(HUNTER_RUNE_1, 1, 10, 500000))
+					st.set("cond", "4");
+				break;
+			
+			case BREKA_ORC_SHAMAN:
+			case BREKA_ORC_OVERLORD:
+				if (st.getInt("cond") == 6 && st.dropItems(HUNTER_RUNE_2, 1, 10, 500000))
+				{
+					st.set("cond", "7");
+					st.giveItems(TALISMAN_OF_SNAKE, 1);
+				}
+				break;
+			
+			case MARSH_STAKATO_WORKER:
+			case MARSH_STAKATO_SOLDIER:
+			case MARSH_STAKATO_DRONE:
+				if (st.getInt("cond") == 10 && st.dropItems(STAKATO_CHITIN, 1, 1, 100000) && st.hasQuestItems(MANASHEN_HORN, MITHRIL_CLIP, REINFORCED_BOWSTRING))
+					st.set("cond", "11");
+				break;
+			
+			case MARSH_SPIDER:
+				if (st.getInt("cond") == 10 && st.dropItems(REINFORCED_BOWSTRING, 1, 1, 100000) && st.hasQuestItems(MANASHEN_HORN, MITHRIL_CLIP, STAKATO_CHITIN))
+					st.set("cond", "11");
+				break;
+			
+			case ROAD_SCAVENGER:
+				if (st.getInt("cond") == 10 && st.dropItems(MITHRIL_CLIP, 1, 1, 100000) && st.hasQuestItems(MANASHEN_HORN, REINFORCED_BOWSTRING, STAKATO_CHITIN))
+					st.set("cond", "11");
+				break;
+			
+			case MANASHEN_GARGOYLE:
+				if (st.getInt("cond") == 10 && st.dropItems(MANASHEN_HORN, 1, 1, 100000) && st.hasQuestItems(REINFORCED_BOWSTRING, MITHRIL_CLIP, STAKATO_CHITIN))
+					st.set("cond", "11");
+				break;
+			
+			case LETO_LIZARDMAN:
+			case LETO_LIZARDMAN_ARCHER:
+			case LETO_LIZARDMAN_SOLDIER:
+			case LETO_LIZARDMAN_WARRIOR:
+			case LETO_LIZARDMAN_SHAMAN:
+			case LETO_LIZARDMAN_OVERLORD:
+				if (st.getInt("cond") == 13)
+				{
+					if (((st.getQuestItemsCount(BLOOD_OF_LIZARDMAN) - 120) * 5) > Rnd.get(100))
+					{
+						st.playSound(QuestState.SOUND_BEFORE_BATTLE);
+						st.takeItems(BLOOD_OF_LIZARDMAN, -1);
+						addSpawn(SERPENT_DEMON_KADESH, player, false, 300000, true);
+					}
+					else
+						st.dropItemsAlways(BLOOD_OF_LIZARDMAN, 1, 0);
+				}
+				break;
+			
+			case SERPENT_DEMON_KADESH:
+				if (st.getInt("cond") == 13)
+				{
+					if (st.getItemEquipped(Inventory.PAPERDOLL_RHAND) == CRESCENT_MOON_BOW)
+					{
+						st.set("cond", "14");
+						st.playSound(QuestState.SOUND_MIDDLE);
+						st.giveItems(TALISMAN_OF_KADESH, 1);
+					}
+					else
+						addSpawn(SERPENT_DEMON_KADESH, player, false, 300000, true);
+				}
+				break;
+		}
+		
+		return null;
+	}
+	
+	public static void main(String[] args)
+	{
+		new Q224_TestOfSagittarius();
+	}
+}
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-01.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-01.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-01.htm	(revision 342)
@@ -0,0 +1,6 @@
+<html><body>Sagittarius Hamil:<br>
+Nice to meet you, young Warrior. Did Bernard send you here? We are in need of help. Your arrival is most timely.<br>
+There is evil afoot in the southern part of the kingdom. The wasteland ants are on the move, and from the east, the Breka Orcs are restive... On top of all this, something weird is happening at the Cruma Tower. The Dwarves are all aflutter about it... Something has awoken beneath the tower...<br>
+I have the feeling that our troubles have just begun... I believe there is more to come, something even bigger.... If only we could find Brankel, we would have more precise information...<br>
+<a action="bypass -h Quest Q224_TestOfSagittarius 30626-02.htm">Ask about Brankel</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30717-01.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30717-01.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30717-01.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Magister Gauen:<br>
+I am Magister Gauen. Ah, yes, Commander Kadesh and the Crescent Bow... That is a story that I'll never forget. Commander Kadesh is the most daring among all the sons of Shilen. He eats like a horse, yet he is always hungry! He is constantly growing... This caused anxiety among the Gods, and they gave instructions to the Elves on how to kill him with <font color="LEVEL">the Crescent Bow</font>. This bow was kept in the Ivory Tower for a long time, and 20 years ago became useless...<br>
+...but if what you are saying is true, we need the bow...<br>
+I can restore the bow, but it will not be easy. Most of the materials I will need you can find in the Ivory Tower, but some you'll have to find elsewhere... <font color="LEVEL">A horn from a manashen gargoyle</font>, <font color="LEVEL">a Reinforced Bowstring</font> made of <font color="LEVEL">the swamp spider's web</font>, <font color="LEVEL">a Mithril Ring</font> which can be obtained from a <font color="LEVEL">road scavenger</font> and <font color="LEVEL">a chitin of a swamp stakato</font> which can be obtained from a <font color="LEVEL">Marsh Stakato worker, a Marsh Stakato soldier, or a Marsh Stakato drone</font>.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-02.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-02.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-02.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Sagittarius Hamil:<br>
+Brankel was sent here before me and left before I arrived.<br>
+Before leaving he entrusted a letter with Merchant Pano addressed to me. I sensed danger even before Brankel was sent here.<br>
+<a action="bypass -h Quest Q224_TestOfSagittarius 30626-03.htm">"What does the letter say?"</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30717-02.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30717-02.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30717-02.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Magister Gauen:<br>
+Here is <font color="LEVEL">the Crescent Bow</font>. This bow is different from other bows, as there is magic in it designed to kill Commander Kadesh. Keep in mind that you can only shoot a <font color="LEVEL">Wooden Arrow</font> with this bow.<br>
+You must kill Commander Kadesh with the Crescent Bow. Right now he is still somewhat weak but as time goes by he will grow stronger and cause more damage. First you must go to <font color="LEVEL">Hamil</font> and find out where Commander Kadesh is located.<br>
+Go now. The Ivory Tower wishes you victory.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-03.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-03.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-03.htm	(revision 342)
@@ -0,0 +1,8 @@
+<html><body>Sagittarius Hamil:<br>
+I will read the letter to you:<br>
+I am leaving now for the Ant's Nest and I'm not sure if I shall return... I will try to leave clues for you to follow me. Please hurry, brother.<br>
+Brankel<br>
+...I wish I could follow him right away, but I am busy defending the village from the Leto Lizardmen... Dammit!<br>
+Please go to the Wastelands and try to find Brankel. If you are unable to find him, look for the traces he said he would leave. The wastelands guardian <font color="LEVEL">Aron Tanford</font> is expecting you at the <font color="LEVEL">southern entrance of the Wastelands</font>.<br>
+You must leave now!
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30717-03.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30717-03.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30717-03.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Magister Gauen:<br>
+To reconstitute the Crescent Bow we need the materials that I previously requested. <font color="LEVEL">The horns of Manashen</font>, <font color="LEVEL">a Reinforced Bowstring</font> made of <font color="LEVEL">the swamp spider's web</font>, <font color="LEVEL">a Mithril Ring</font> which can be taken from a <font color="LEVEL">road scavenger</font> and a <font color="LEVEL">chitin</font> that can be obtained from <font color="LEVEL">a swamp stakato worker, a swamp stakato soldier or a swamp stakato drone</font>. Please hurry and get these items for me.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-04.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-04.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-04.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Sagittarius Hamil:<br>
+There is no time to lose! You must go and meet <font color="LEVEL">Aron Tanford</font> immediately!
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30717-04.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30717-04.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30717-04.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Magister Gauen:<br>
+20 years ago Hamil and my master prevented the rebirth of Commander Kadesh... Take this bow to Hamil immediately!
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-05.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-05.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-05.htm	(revision 342)
@@ -0,0 +1,4 @@
+<html><body>Sagittarius Hamil:<br>
+Ah, hunter's runes written on the pebbles...? Yes, this is the secret code used by hunters. We must place the pebbles in order...<br>
+<a action="bypass -h Quest Q224_TestOfSagittarius 30626-06.htm">Place the Hunter's Runes</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-06.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-06.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-06.htm	(revision 342)
@@ -0,0 +1,7 @@
+<html><body>Sagittarius Hamil:<br>
+Hmm... Let's see...<br>
+Ant's Nest... deep... black serpent... egg..., dark, no, abyss...!? child of abyss...! Hmm, this is...! Yes, here we go! 'In the hands of the children of abyss'... 'to the Breka Orcs'...<br>
+<font color="LEVEL">'the black serpent's egg'</font> to the <font color="LEVEL">'children of abyss'</font>...?<br>
+The castle of the evil Beleth once stood in the present-day Wastelands... This is why there are so many malevolent artifacts there. Perhaps the black egg that Brankel mentioned has something to do with Beleth...<br>
+<a action="bypass -h Quest Q224_TestOfSagittarius 30626-07.htm">Ask about the Children of Abyss</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-07.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-07.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-07.htm	(revision 342)
@@ -0,0 +1,6 @@
+<html><body>Sagittarius Hamil:<br>
+Those heathen followers of the Goddess of Destruction. Or should I say 'The children of Shilen'... Bah!<br>
+I am sure that race is behind the mischief that has been going on lately!<br>
+You must hurry and go to Giran! If what Brankel says is true, the Breka Orcs are having the black egg delivered to them! Are these the only runes you found? There are likely more of them so keep searching.<br>
+You should go to <font color="LEVEL">the Town of Giran</font> and meet <font color="LEVEL">Prefect Vokian</font>. He owes me a favor, and will certainly help. Some things only an Orc can do. Ask him about the Breka Orcs.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-08.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-08.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-08.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Sagittarius Hamil:<br>
+<font color="LEVEL">Prefect Vokian</font> is an old friend of mine. He saved my life once and I saved his twice! Out of the death crisis. You must hurry to <font color="LEVEL">the Town of Giran</font> and meet him. I hope to hear good news from you soon.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-09.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-09.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q224_TestOfSagittarius/30626-09.htm	(revision 342)
@@ -0,0 +1,7 @@
+<html><body>Sagittarius Hamil:<br>
+Who would have thought that they could mobilize those savage heathens to join in their plot?<br>
+Lets see what Brankel has to say...<br>
+Oh, no, we are too late! The Orc shamans have revived the serpent and awakened the Commander! Ah, yes... <font color="LEVEL">Commander Kadesh</font>! I hoped to never hear that name again....<br>
+He is a devil who appears as a serpent. It was he who spread blood and pestilence in this land of south Oren long ago... Devils such as he are not of this earth and are not easily killed. Brankel mentions the <font color="LEVEL">Crescent Bow</font>. But the crescent bow...<br>
+Nevermind, we'll deal with that later. You must go to the <font color="LEVEL">Ivory tower of Oren</font> and meet <font color="LEVEL">Magister Gauen</font>. I believe that he is the keeper of the Crescent Bow...
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-10.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-10.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-10.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Blacksmith Wilbert:<br>
+You need 50 spirit beads to play. I can plainly see that you don't have enough; why don't you go get some more and come back?
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-11.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-11.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-11.htm	(revision 342)
@@ -0,0 +1,4 @@
+<html><body>Blacksmith Wilbert:<br>
+Where have you been? I've been sitting here waiting for you. Let's get started, eh? Draw your card.<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-14.htm">Draw a card.</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-12.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-12.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-12.htm	(revision 342)
@@ -0,0 +1,11 @@
+<html><body>Blacksmith Wilbert:<br>
+Ah! Thank the gods, it's my turn again. You drew: <font color="LEVEL">%card2pic%</font>.<br>
+The cards on the table are:<br>
+<table border="0" border color="white" width="230" height="60">
+<tr><td width="80" height="20" align="center">[Wilbert]</td><td width="150" height="20" align="center">[ %name% ]</td></tr>
+<tr><td width="80" height="30" align="center">%card1pic%</td><td width="150" height="30" align="center">%card2pic%</td></tr>
+</table>
+<br>
+Can I draw my card now?<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-19.htm">Tell him to draw a card.</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-30.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-30.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-30.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Blacksmith Wilbert:<br>
+Well, it's a shame that you want to stop. If you want to play again, come by any time. I certainly enjoyed it!
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-13.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-13.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-13.htm	(revision 342)
@@ -0,0 +1,14 @@
+<html><body>Blacksmith Wilbert:<br>
+Let's see, now... The card you drew is <font color="LEVEL">%card2pic%</font>.<br>
+<br>
+The cards on the table are:<br>
+<table border="0" border color="white" width="230" height="60">
+<tr><td width="80" height="20" align="center">[Wilbert]</td><td width="150" height="20" align="center">[ %name% ]</td></tr>
+<tr><td width="80" height="30" align="center">%card1pic%</td><td width="150" height="30" align="center">%card2pic%</td></tr>
+</table>
+<br>
+Dragon's spore! You've won. If my luck stays this bad, I'm going to have a lot of explaining to do to the missus!<br>
+By my reckonin', you have %wincount% consecutive wins. Do you want to quit? Or would you like to keep playing?<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-20.htm">Challenge him again.</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-21.htm">Quit the game and collect the prize.</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-31.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-31.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-31.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Blacksmith Wilbert:<br>
+What's the matter? You started the game, so you should finish it. Are you really going to quit now?<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-32.htm">"I'll come by next time."</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-30.htm">"I don't want to play any more."</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-22a.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-22a.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-22a.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Blacksmith Wilbert:<br>
+Don't even think about coming over here if you don't have any beads!
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-14.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-14.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-14.htm	(revision 342)
@@ -0,0 +1,10 @@
+<html><body>Blacksmith Wilbert:<br>
+The card you drew is: %card2pic%. The cards on the table are:<br>
+<table border="0" border color="white" width="230" height="60">
+<tr><td width="80" height="20" align="center">[Wilbert]</td><td width="150" height="20" align="center">[ %name% ]</td></tr>
+<tr><td width="80" height="30" align="center">%card1pic%</td><td width="150" height="30" align="center">%card2pic%</td></tr>
+</table>
+<br>
+Has it been 8 consecutive wins already!?<br>
+I've never seen anybody play this well! The gods have truly blessed you with both great skill and great luck. I'd be honored to try my luck against you some time -- please feel free to look me up when you have some free time and an itch to play. In the meantime, take this.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-32.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-32.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-32.htm	(revision 342)
@@ -0,0 +1,4 @@
+<html><body>Blacksmith Wilbert:<br>
+Very well. You look very tired.<br>
+Come back when you are rested. I'll be waiting for you here.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-15.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-15.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-15.htm	(revision 342)
@@ -0,0 +1,4 @@
+<html><body>Blacksmith Wilbert:<br>
+Stop interrupting the game! Well, it seems like I get my chance as well. Do you think I can draw my card?<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-19.htm">Tell him to show his card.</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-16.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-16.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-16.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Blacksmith Wilbert:<br>
+You've won <font color="LEVEL">%wincount%</font> in a row. Would you like to quit? Or do you want to keep playing?<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-20.htm">Continue the game.</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-21.htm">Quit the game and collect the prize.</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-17.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-17.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-17.htm	(revision 342)
@@ -0,0 +1,3 @@
+<html><body>Wilbert:<br>
+By my mother's braids, I've never seen anyone play this well! You must be chosen by the gods, my friend, for your luck is surely supernatural. Maybe I'm a glutton for punishment, but I'd love to play again sometime. Here, take this.
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-18.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-18.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-18.htm	(revision 342)
@@ -0,0 +1,11 @@
+<html><body>Blacksmith Wilbert:<br>
+Oh well... Ah, it's your turn again. I drew: <font color="LEVEL">%card2pic%</font>.<br>
+The cards on the table are:<br>
+<table border="0" border color="white" width="230" height="60">
+<tr><td width="80" height="20" align="center">[Wilbert]</td><td width="150" height="20" align="center">[ %name% ]</td></tr>
+<tr><td width="80" height="30" align="center"><font color="f00fff">%card2pic%</font></td><td width="150" height="30" align="center"><font color="f9911e">%card1pic%</font></td></tr>
+</table><br>
+<br>
+Draw a card.<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-14.htm">Take out the card.</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-19.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-19.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-19.htm	(revision 342)
@@ -0,0 +1,11 @@
+<html><body>Blacksmith Wilbert:<br>
+Let's see here... The card I took out is: <font color="LEVEL">%card2pic%</font>.<br>
+The cards on the table are:<br>
+<table border="0" border color="white" width="230" height="60">
+<tr><td width="80" height="20" align="center">[Wilbert]</td><td width="150" height="20" align="center">[ %name% ]</td></tr>
+<tr><td width="80" height="30" align="center"><font color="f00fff">%card2pic%</font></td><td width="150" height="30" align="center"><font color="f9911e">%card1pic%</font></td></tr>
+</table><br>
+<br>
+Luck! Looks like I win. It was a good game, though, eh? If you'd like to play again, feel free to challenge me.<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-21a.htm">Challenge him again.</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/Q663_SeductiveWhispers.java
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/Q663_SeductiveWhispers.java	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/Q663_SeductiveWhispers.java	(revision 342)
@@ -0,0 +1,512 @@
+/*
+ * This program is free software: you can redistribute it and/or modify it under
+ * the terms of the GNU General Public License as published by the Free Software
+ * Foundation, either version 3 of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful, but WITHOUT
+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
+ * FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along with
+ * this program. If not, see <http://www.gnu.org/licenses/>.
+ */
+package quests.Q663_SeductiveWhispers;
+
+import java.util.HashMap;
+import java.util.Map;
+
+import net.sf.l2j.gameserver.model.actor.L2Npc;
+import net.sf.l2j.gameserver.model.actor.instance.L2PcInstance;
+import net.sf.l2j.gameserver.model.quest.Quest;
+import net.sf.l2j.gameserver.model.quest.QuestState;
+import net.sf.l2j.util.Rnd;
+
+public class Q663_SeductiveWhispers extends Quest
+{
+	private static final String qn = "Q663_SeductiveWhispers";
+	
+	// NPC
+	private static final int WILBERT = 30846;
+	
+	// Quest item
+	private static final int SPIRIT_BEAD = 8766;
+	
+	// Rewards
+	private static final int ADENA = 57;
+	private static final int ENCHANT_WEAPON_A = 729;
+	private static final int ENCHANT_ARMOR_A = 730;
+	private static final int ENCHANT_WEAPON_B = 947;
+	private static final int ENCHANT_ARMOR_B = 948;
+	private static final int ENCHANT_WEAPON_C = 951;
+	private static final int ENCHANT_WEAPON_D = 955;
+	
+	private static final int RECIPES[] =
+	{
+		2353,
+		4963,
+		4967,
+		5000,
+		5001,
+		5002,
+		5004,
+		5005,
+		5006,
+		5007
+	};
+	
+	private static final int BLADES[] =
+	{
+		2115,
+		4104,
+		4108,
+		4114,
+		4115,
+		4116,
+		4118,
+		4119,
+		4120,
+		4121
+	};
+	
+	// Text of cards
+	private static final Map<Integer, String> CARDS = new HashMap<>();
+	{
+		CARDS.put(0, "No such card");
+		CARDS.put(11, "<font color=\"ff453d\"> Sun Card: 1 </font>");
+		CARDS.put(12, "<font color=\"ff453d\"> Sun Card: 2 </font>");
+		CARDS.put(13, "<font color=\"ff453d\"> Sun Card: 3 </font>");
+		CARDS.put(14, "<font color=\"ff453d\"> Sun Card: 4 </font>");
+		CARDS.put(15, "<font color=\"ff453d\"> Sun Card: 5 </font>");
+		CARDS.put(21, "<font color=\"fff802\"> Moon Card: 1 </font>");
+		CARDS.put(22, "<font color=\"fff802\"> Moon Card: 2 </font>");
+		CARDS.put(23, "<font color=\"fff802\"> Moon Card: 3 </font>");
+		CARDS.put(24, "<font color=\"fff802\"> Moon Card: 4 </font>");
+		CARDS.put(25, "<font color=\"fff802\"> Moon Card: 5 </font>");
+	};
+	
+	// Drop chances
+	private static final Map<Integer, Integer> CHANCES = new HashMap<>();
+	{
+		CHANCES.put(20674, 807000); // Doom Knight
+		CHANCES.put(20678, 372000); // Tortured Undead
+		CHANCES.put(20954, 460000); // Hungered Corpse
+		CHANCES.put(20955, 537000); // Ghost War
+		CHANCES.put(20956, 540000); // Past Knight
+		CHANCES.put(20957, 565000); // Nihil Invader
+		CHANCES.put(20958, 425000); // Death Agent
+		CHANCES.put(20959, 682000); // Dark Guard
+		CHANCES.put(20960, 372000); // Bloody Ghost
+		CHANCES.put(20961, 547000); // Bloody Knight
+		CHANCES.put(20962, 522000); // Bloody Priest
+		CHANCES.put(20963, 498000); // Bloody Lord
+		CHANCES.put(20974, 1000000); // Spiteful Soul Leader
+		CHANCES.put(20975, 975000); // Spiteful Soul Wizard
+		CHANCES.put(20976, 825000); // Spiteful Soul Fighter
+		CHANCES.put(20996, 385000); // Spiteful Ghost of Ruins
+		CHANCES.put(20997, 342000); // Soldier of Grief
+		CHANCES.put(20998, 377000); // Cruel Punisher
+		CHANCES.put(20999, 450000); // Roving Soul
+		CHANCES.put(21000, 395000); // Soul of Ruins
+		CHANCES.put(21001, 535000); // Wretched Archer
+		CHANCES.put(21002, 472000); // Doom Scout
+		CHANCES.put(21006, 502000); // Doom Servant
+		CHANCES.put(21007, 540000); // Doom Guard
+		CHANCES.put(21008, 692000); // Doom Archer
+		CHANCES.put(21009, 740000); // Doom Trooper
+		CHANCES.put(21010, 595000); // Doom Warrior
+	};
+	
+	public Q663_SeductiveWhispers()
+	{
+		super(663, qn, "Seductive Whispers");
+		
+		setItemsIds(SPIRIT_BEAD);
+		
+		addStartNpc(WILBERT);
+		addTalkId(WILBERT);
+		
+		for (int npcId : CHANCES.keySet())
+			addKillId(npcId);
+	}
+	
+	@Override
+	public String onAdvEvent(String event, L2Npc npc, L2PcInstance player)
+	{
+		String htmltext = event;
+		QuestState st = player.getQuestState(qn);
+		if (st == null)
+			return htmltext;
+		
+		int state = st.getInt("state");
+		
+		if (event.equalsIgnoreCase("30846-03.htm"))
+		{
+			st.setState(STATE_STARTED);
+			st.set("cond", "1");
+			st.set("state", "1");
+			st.playSound(QuestState.SOUND_ACCEPT);
+		}
+		else if (event.equalsIgnoreCase("30846-09.htm") && (state % 10) <= 4)
+		{
+			if ((state / 10) < 1)
+			{
+				if (st.getQuestItemsCount(SPIRIT_BEAD) >= 50)
+				{
+					st.takeItems(SPIRIT_BEAD, 50);
+					st.set("state", "5");
+				}
+				else
+					htmltext = "30846-10.htm";
+			}
+			else
+			{
+				st.set("state", String.valueOf((state / 10) * 10 + 5));
+				st.set("stateEx", "0");
+				htmltext = "30846-09a.htm";
+			}
+		}
+		else if (event.equalsIgnoreCase("30846-14.htm") && (state % 10) == 5 && (state / 1000) == 0)
+		{
+			int i0 = st.getInt("stateEx");
+			
+			int i1 = i0 % 10;
+			int i2 = (i0 - i1) / 10;
+			
+			int param1 = Rnd.get(2) + 1;
+			int param2 = Rnd.get(5) + 1;
+			
+			int i5 = state / 10;
+			
+			int param3 = param1 * 10 + param2;
+			
+			if (param1 == i2)
+			{
+				int i3 = param2 + i1;
+				
+				if (i3 % 5 == 0 && i3 != 10)
+				{
+					if ((state % 100) / 10 >= 7)
+					{
+						st.set("state", "4");
+						st.rewardItems(ADENA, 2384000);
+						st.rewardItems(ENCHANT_WEAPON_A, 1);
+						st.rewardItems(ENCHANT_ARMOR_A, 1);
+						st.rewardItems(ENCHANT_ARMOR_A, 1);
+						htmltext = getHTML("30846-14.htm", i0, param3, player.getName());
+					}
+					else
+					{
+						st.set("state", String.valueOf((state / 10) * 10 + 7));
+						htmltext = getHTML("30846-13.htm", i0, param3, player.getName()).replace("%wincount%", String.valueOf(i5 + 1));
+					}
+				}
+				else
+				{
+					st.set("state", String.valueOf((state / 10) * 10 + 6));
+					st.set("stateEx", String.valueOf(param3));
+					htmltext = getHTML("30846-12.htm", i0, param3, player.getName());
+				}
+			}
+			else
+			{
+				if (param2 == 5 || i1 == 5)
+				{
+					if ((state % 100) / 10 >= 7)
+					{
+						st.set("state", "4");
+						st.rewardItems(ADENA, 2384000);
+						st.rewardItems(ENCHANT_WEAPON_A, 1);
+						st.rewardItems(ENCHANT_ARMOR_A, 1);
+						st.rewardItems(ENCHANT_ARMOR_A, 1);
+						htmltext = getHTML("30846-14.htm", i0, param3, player.getName());
+					}
+					else
+					{
+						st.set("state", String.valueOf((state / 10) * 10 + 7));
+						htmltext = getHTML("30846-13.htm", i0, param3, player.getName()).replace("%wincount%", String.valueOf(i5 + 1));
+					}
+				}
+				else
+				{
+					st.set("state", String.valueOf((state / 10) * 10 + 6));
+					st.set("stateEx", String.valueOf(param1 * 10 + param2));
+					htmltext = getHTML("30846-12.htm", i0, param3, player.getName());
+				}
+			}
+		}
+		else if (event.equalsIgnoreCase("30846-19.htm") && (state % 10) == 6 && (state / 1000) == 0)
+		{
+			int i0 = st.getInt("stateEx");
+			
+			int i1 = i0 % 10;
+			int i2 = (i0 - i1) / 10;
+			
+			int param1 = Rnd.get(2) + 1;
+			int param2 = Rnd.get(5) + 1;
+			int param3 = param1 * 10 + param2;
+			
+			if (param1 == i2)
+			{
+				int i3 = param1 + i1;
+				
+				if (i3 % 5 == 0 && i3 != 10)
+				{
+					st.set("state", "1");
+					st.set("stateEx", "0");
+					htmltext = getHTML("30846-19.htm", i0, param3, player.getName());
+				}
+				else
+				{
+					st.set("state", String.valueOf((state / 10) * 10 + 5));
+					st.set("stateEx", String.valueOf(param3));
+					htmltext = getHTML("30846-18.htm", i0, param3, player.getName());
+				}
+			}
+			else
+			{
+				if (param2 == 5 || i1 == 5)
+				{
+					st.set("state", "1");
+					htmltext = getHTML("30846-19.htm", i0, param3, player.getName());
+				}
+				else
+				{
+					st.set("state", String.valueOf((state / 10) * 10 + 5));
+					st.set("stateEx", String.valueOf(param3));
+					htmltext = getHTML("30846-18.htm", i0, param3, player.getName());
+				}
+			}
+		}
+		else if (event.equalsIgnoreCase("30846-20.htm") && (state % 10) == 7 && (state / 1000) == 0)
+		{
+			st.set("state", String.valueOf((state / 10 + 1) * 10 + 4));
+			st.set("stateEx", "0");
+		}
+		else if (event.equalsIgnoreCase("30846-21.htm") && (state % 10) == 7 && (state / 1000) == 0)
+		{
+			int round = state / 10;
+			
+			if (round == 0)
+				st.rewardItems(ADENA, 40000);
+			else if (round == 1)
+				st.rewardItems(ADENA, 80000);
+			else if (round == 2)
+			{
+				st.rewardItems(ADENA, 110000);
+				st.rewardItems(ENCHANT_WEAPON_D, 1);
+			}
+			else if (round == 3)
+			{
+				st.rewardItems(ADENA, 199000);
+				st.rewardItems(ENCHANT_WEAPON_C, 1);
+			}
+			else if (round == 4)
+			{
+				st.rewardItems(ADENA, 388000);
+				st.rewardItems(RECIPES[Rnd.get(RECIPES.length)], 1);
+			}
+			else if (round == 5)
+			{
+				st.rewardItems(ADENA, 675000);
+				st.rewardItems(BLADES[Rnd.get(BLADES.length)], 1);
+			}
+			else if (round == 6)
+			{
+				st.rewardItems(ADENA, 1284000);
+				st.rewardItems(ENCHANT_WEAPON_B, 1);
+				st.rewardItems(ENCHANT_ARMOR_B, 1);
+				st.rewardItems(ENCHANT_WEAPON_B, 1);
+				st.rewardItems(ENCHANT_ARMOR_B, 1);
+			}
+			
+			st.set("state", "1");
+			st.set("stateEx", "0");
+		}
+		else if (event.equalsIgnoreCase("30846-22.htm") && (state % 10) == 1)
+		{
+			if (st.hasQuestItems(SPIRIT_BEAD))
+			{
+				st.set("state", "1005");
+				st.takeItems(SPIRIT_BEAD, 1);
+			}
+			else
+				htmltext = "30846-22a.htm";
+		}
+		else if (event.equalsIgnoreCase("30846-25.htm") && state == 1005)
+		{
+			int i0 = st.getInt("stateEx");
+			
+			int i1 = i0 % 10;
+			int i2 = (i0 - i1) / 10;
+			
+			int param1 = Rnd.get(2) + 1;
+			int param2 = Rnd.get(5) + 1;
+			int param3 = param1 * 10 + param2;
+			
+			if (param1 == i2)
+			{
+				int i3 = param2 + i1;
+				
+				if (i3 % 5 == 0 && i3 != 10)
+				{
+					st.set("state", "1");
+					st.set("stateEx", "0");
+					st.rewardItems(ADENA, 800);
+					htmltext = getHTML("30846-25.htm", i0, param3, player.getName()).replace("%card1%", String.valueOf(i1));
+				}
+				else
+				{
+					st.set("state", "1006");
+					st.set("stateEx", String.valueOf(param3));
+					htmltext = getHTML("30846-24.htm", i0, param3, player.getName());
+				}
+			}
+			else
+			{
+				if (param2 == 5 || i2 == 5)
+				{
+					st.set("state", "1");
+					st.set("stateEx", "0");
+					st.rewardItems(ADENA, 800);
+					htmltext = getHTML("30846-25.htm", i0, param3, player.getName()).replace("%card1%", String.valueOf(i1));
+				}
+				else
+				{
+					st.set("state", "1006");
+					st.set("stateEx", String.valueOf(param3));
+					htmltext = getHTML("30846-24.htm", i0, param3, player.getName());
+				}
+			}
+		}
+		else if (event.equalsIgnoreCase("30846-29.htm") && state == 1006)
+		{
+			int i0 = st.getInt("stateEx");
+			
+			int i1 = i0 % 10;
+			int i2 = (i0 - i1) / 10;
+			
+			int param1 = Rnd.get(2) + 1;
+			int param2 = Rnd.get(5) + 1;
+			int param3 = param1 * 10 + param2;
+			
+			if (param1 == i2)
+			{
+				int i3 = param2 + i1;
+				
+				if (i3 % 5 == 0 && i3 != 10)
+				{
+					st.set("state", "1");
+					st.set("stateEx", "0");
+					st.rewardItems(ADENA, 800);
+					htmltext = getHTML("30846-29.htm", i0, param3, player.getName()).replace("%card1%", String.valueOf(i1));
+				}
+				else
+				{
+					st.set("state", "1005");
+					st.set("stateEx", String.valueOf(param3));
+					htmltext = getHTML("30846-28.htm", i0, param3, player.getName());
+				}
+			}
+			else
+			{
+				if (param2 == 5 || i1 == 5)
+				{
+					st.set("state", "1");
+					st.set("stateEx", "0");
+					htmltext = getHTML("30846-29.htm", i0, param3, player.getName());
+				}
+				else
+				{
+					st.set("state", "1005");
+					st.set("stateEx", String.valueOf(param3));
+					htmltext = getHTML("30846-28.htm", i0, param3, player.getName());
+				}
+			}
+		}
+		else if (event.equalsIgnoreCase("30846-30.htm"))
+		{
+			st.playSound(QuestState.SOUND_FINISH);
+			st.exitQuest(true);
+		}
+		
+		return htmltext;
+	}
+	
+	@Override
+	public String onTalk(L2Npc npc, L2PcInstance player)
+	{
+		QuestState st = player.getQuestState(qn);
+		String htmltext = getNoQuestMsg();
+		if (st == null)
+			return htmltext;
+		
+		switch (st.getState())
+		{
+			case STATE_CREATED:
+				htmltext = (player.getLevel() < 50) ? "30846-02.htm" : "30846-01.htm";
+				break;
+			
+			case STATE_STARTED:
+				int state = st.getInt("state");
+				
+				if (state < 4)
+				{
+					if (st.hasQuestItems(SPIRIT_BEAD))
+						htmltext = "30846-05.htm";
+					else
+						htmltext = "30846-04.htm";
+				}
+				else if ((state % 10) == 4)
+					htmltext = "30846-05a.htm";
+				else if ((state % 10) == 5)
+					htmltext = "30846-11.htm";
+				else if ((state % 10) == 6)
+					htmltext = "30846-15.htm";
+				else if ((state % 10) == 7)
+				{
+					int round = (state % 100) / 10;
+					
+					if (round >= 7)
+					{
+						st.rewardItems(ADENA, 2384000);
+						st.rewardItems(ENCHANT_WEAPON_A, 1);
+						st.rewardItems(ENCHANT_ARMOR_A, 1);
+						st.rewardItems(ENCHANT_ARMOR_A, 1);
+						htmltext = "30846-17.htm";
+					}
+					else
+						htmltext = getHtmlText("30846-16.htm").replace("%wincount%", String.valueOf((state / 10) + 1));
+				}
+				else if (state == 1005)
+					htmltext = "30846-23.htm";
+				else if (state == 1006)
+					htmltext = "30846-26.htm";
+				
+				break;
+		}
+		
+		return htmltext;
+	}
+	
+	@Override
+	public String onKill(L2Npc npc, L2PcInstance player, boolean isPet)
+	{
+		L2PcInstance partyMember = getRandomPartyMemberState(player, npc, STATE_STARTED);
+		if (partyMember == null)
+			return null;
+		
+		partyMember.getQuestState(qn).dropItems(SPIRIT_BEAD, 1, 0, CHANCES.get(npc.getNpcId()));
+		
+		return null;
+	}
+	
+	private String getHTML(String html, int index, int param3, String name)
+	{
+		return getHtmlText(html).replace("%card1pic%", CARDS.get(index)).replace("%card2pic%", CARDS.get(param3)).replace("%name%", name);
+	}
+	
+	public static void main(String[] args)
+	{
+		new Q663_SeductiveWhispers();
+	}
+}
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-01.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-01.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-01.htm	(revision 342)
@@ -0,0 +1,6 @@
+<html><body>Blacksmith Wilbert:<br>
+Hey, you, traveler! Come over here, my friend.<br>
+You look a little bored. Not sure how what to do with yourself?<br>
+How about we play a little game that's pretty popular in these parts? I think you'll enjoy it.<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-01a.htm">"What's the game?"</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-20.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-20.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-20.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Blacksmith Wilbert:<br>
+First just let me warm up a little. Ah...that's better. Let's play! Whenever you're ready, my friend...<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-09.htm">Tell him you're ready.</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-32.htm">Tell him you're going to take a little break.</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-01a.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-01a.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-01a.htm	(revision 342)
@@ -0,0 +1,4 @@
+<html><body>Blacksmith Wilbert:<br>
+From time to time, we enjoy a duel game called <font color="LEVEL">The Battle of Sun and Moon</font>. It's pretty popular in these parts, in case you haven't heard of it. I've found it a great way to pass the time when you're between jobs. Just say the word and I'll teach you everything you need to know. What do you say?<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-03.htm">"I'd like to play."</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-02.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-02.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-02.htm	(revision 342)
@@ -0,0 +1,4 @@
+<html><body>Blacksmith Wilbert:<br>
+Hey there! Yeah, you, traveler! When you're a little less green, come see me for some excitement you won't soon forget.<br>
+(Only characters level 50 and above are permitted to take on this quest.)
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-21.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-21.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-21.htm	(revision 342)
@@ -0,0 +1,6 @@
+<html><body>Blacksmith Wilbert:<br>
+My my, you're doing very well, aren't you? I bet you could take everything I have if this keeps up! Well, here's your winnings.<br>
+Say, how about we keep playing?<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-09.htm">Continue the game.</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-32.htm">Stop the game for a while.</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-03.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-03.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-03.htm	(revision 342)
@@ -0,0 +1,7 @@
+<html><body>Blacksmith Wilbert:<br>
+All right! If that's what you want, I'll let you you join in.<br>
+You can't be ready for the game already, can you? You're not thinking of joining in without bringing anything to the table, are you? You have to go get one item if you want to enjoy a game with us. It's not so hard to find, but we need to have <font color="LEVEL">Spirit Beads</font> to make weapons. I'll give you the details another time, but for now, go to <font color="LEVEL">Aden Cemetery, the Ancient Battlegrounds and the Fields of Massacre</font> and get some <font color="LEVEL">Spirit Beads</font> from the undead and the demons.<br>
+Didn't I explain it well enough?<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-06.htm">"What is a Spirit Bead?"</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-07.htm">"How do you play the game called War Between the Sun and the Moon?"</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-22.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-22.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-22.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Blacksmith Wilbert:<br>
+Let's start then! First, give me 1 Spirit Bead. Now pick any card you want from this box. You know the rules, right?<br>
+When you're ready, go ahead and draw a card.<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-25.htm">Draw a card.</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-21a.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-21a.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-21a.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Blacksmith Wilbert:<br>
+First, let me get warmed up. Shall we play again?. When you're ready, just let me know.<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-09.htm">Say that you're ready.</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-32.htm">Tell him that you want to take a break.</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-04.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-04.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-04.htm	(revision 342)
@@ -0,0 +1,8 @@
+<html><body>Blacksmith Wilbert:<br>
+You know that you need a <font color="LEVEL">Spirit Bead</font> to play the game, right?  Now, why don't you go get some so we can get started?<br>
+Go to <font color = "LEVEL">the National Cemetery, the Ancient Battlegrounds and the Fields of Massacre</font> and get some <font color="LEVEL">Spirit Beads</font> from the undead and the demons.<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-30.htm">"I don't want to play this game anymore."</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-06.htm">"What is a Spirit Bead?"</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-07.htm">"How do you play the game called War Between the Sun and the Moon?"</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-31.htm">"I quit."</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-23.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-23.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-23.htm	(revision 342)
@@ -0,0 +1,4 @@
+<html><body>Blacksmith Wilbert:<br>
+I've been waiting for you! Ready to get started? Draw a card.<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-25.htm">Draw a card.</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-05.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-05.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-05.htm	(revision 342)
@@ -0,0 +1,9 @@
+<html><body>Blacksmith Wilbert:<br>
+Ha ha! Think you have what it takes to be a winner? Yes? How about the two of us play a round or two? Tell you what, we can even practice a little first if you prefer. Of course, even a practice run isn't free -- after all, why play at all if there isn't something at stake? But I'll make the stakes low, so learning won't cost you much. Let's say... 1 <font color="LEVEL">Spirit Bead</font>. And if you win, I'll give you 800 adena! Can't beat that, my friend.<br>
+Once you're ready to play for real, just hand over the <font color="LEVEL">Spirit Beads</font> and let me know! So what'll it be?<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-22.htm">"I want to practice." (Requires 1 Spirit Bead)</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-09.htm">"I want to play." (Requires 50 Spirit Beads)</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-06.htm">"What is a Spirit Bead?"</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-07.htm">"How do you play the game?"</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-31.htm">"I don't want to play."</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-24.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-24.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-24.htm	(revision 342)
@@ -0,0 +1,10 @@
+<html><body>Blacksmith Wilbert:<br>
+Whew! Thankfully, it's my turn again. The card you drew is: <font color="LEVEL">%card2pic%</font>. The cards on the table are:<br>
+<table border="0" border color="white" width="230" height="60">
+<tr><td width="80" height="20" align="center">[Wilbert]</td><td width="150" height="20" align="center">[ %name% ]</td></tr>
+<tr><td width="80" height="30" align="center">%card1pic%</td><td width="150" height="30" align="center">%card2pic%</td></tr>
+</table><br>
+<br>
+Can I draw my card now?<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-29.htm">Tell him to draw a card.</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-05a.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-05a.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-05a.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Blacksmith Wilbert:<br>
+The game should run continuously. When you're ready to begin, just say the word.<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-09.htm">Start playing.</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-30.htm">Quit the game.</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-06.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-06.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-06.htm	(revision 342)
@@ -0,0 +1,11 @@
+<html><body>Blacksmith Wilbert:<br>
+When a being's thought or spirit energy comes together into the shape of a bead, we call that a Spirit Bead. Artisans like me need them to make good weapons. That's why we gamble with them -- as they're worth a lot to us. In this area, they say that you can easily get Spirit Beads if you go to <font color="LEVEL">Aden Cemetery, The Ancient Battlegrounds and the Fields of Massacre</font>.<br>
+First, at <font color="LEVEL">The Cemetery</font>, you can obtain <font color="LEVEL">Spirit Beads</font> from the undead creatures known as the <font color="LEVEL">Spiteful Ghost of Ruin, Soldier of Grief, Cruel Punisher, Roving Soul, Tortured Undead and Wasted Soul</font>.<br>
+Second, at <font color="LEVEL">the Ancient Battlegrounds</font>, you can obtain <font color="LEVEL">Spirit Beads</font> from the undead known as <font color="LEVEL">Past Knight, Ghostly Warrior, Hungered Corpse, the Dark Guard, Death Agent and Nihil Invader</font> and from the demons known as <font color="LEVEL">Bloody Lord, Bloody Priest, Bloody Knight and Bloody Ghost</font>.<br><br>
+Lastly, at the <font color="LEVEL">Fields of Massacre</font>, you can obtain <font color="LEVEL">Spirit Beads</font> from the undead known as <font color="LEVEL">Doom Scout, Doom Servant, Doom Guard, Doom Archer, Doom Trooper, Doom Warrior, Doom Knight, Wretched Archer, Spiteful Soul Leader, Spiteful Soul Wizard and Spiteful Soul Fighter</font>.<br>
+I think that's enough information for you to get started. Is there anything else you'd like to know?<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-07.htm">"How do you play the game of War Between the Sun and the Moon?"</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-08.htm">"What do you get for winning the game?"</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-22.htm">"I want to practice." (Need 1 Spirit Bead.)</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-09.htm">"Let's play!" (Need 50 Spirit Beads.)</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-25.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-25.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-25.htm	(revision 342)
@@ -0,0 +1,12 @@
+<html><body>Blacksmith Wilbert:<br>
+The card that you took out is: <font color="LEVEL">%card2pic%</font>. The cards on the table are:<br>
+<table border="0" border color="white" width="230" height="60">
+<tr><td width="80" height="20" align="center">[Wilbert]</td><td width="150" height="20" align="center">[ %name% ]</td></tr>
+<tr><td width="80" height="30" align="center">%card1pic%</td><td width="150" height="30" align="center">%card2pic%</td></tr>
+</table>
+<br>
+So that's how you play the game. Pretty simple, eh? If you want to join a real game, let me know.<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-22.htm">I want to practice some more. (Need 1 Spirit Bead.)</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-09.htm">Let's play the game. (Need 50 Spirit Beads.)</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-32.htm">Let's play later.</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-07.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-07.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-07.htm	(revision 342)
@@ -0,0 +1,12 @@
+<html><body>Blacksmith Wilbert:<br>
+Actually, we once played this game using the images on the Spirit Beads themselves, but it became easier to just use cards marked with images of Suns or Moons. Listen up! There are 10 types of cards, each marked with 1 to 5 <font color="LEVEL">pictures of the Sun or Moon</font>. Here's how to play:<br>
+First, cards are dealt to each person in order. The last card drawn is placed face up.<br>
+Check how many pictures your cards have on them.<br>
+If there is more than one more card with 5 pictures on it, the person who got the card last wins.<br>
+Simple, eh?<br>
+Anything else you'd like to know?<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-06.htm">"What is a Spirit Bead?"</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-08.htm">"What do you get when you win the game?"</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-22.htm">"I want to practice." (Need 1 Spirit Bead.)</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-09.htm">"Let's play." (Need 50 Spirit Beads.)</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-26.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-26.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-26.htm	(revision 342)
@@ -0,0 +1,4 @@
+<html><body>Blacksmith Wilbert:<br>
+Stop interrupting the game! Ah, well, it seems as though I get a chance as well. Tell me, my friend, do you think I can draw my card?<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-29.htm">Tell him to draw a card.</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-08.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-08.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-08.htm	(revision 342)
@@ -0,0 +1,17 @@
+<html><body>Blacksmith Wilbert:<br>
+If you win the game, the master running it owes you the appropriate amount. The higher the round, the bigger the payout. That's why the game only allows you to win up to 8 rounds in a row. If -- and that's a big if -- you manage to win 8 straight times, the game will end.<br>
+Keep in mind that <font color="LEVEL">if you lose any of the rounds, you get nothing</font>. That's fair warning, my friend. Here's how the prize system works:<br>
+1 winning round: 40,000 Adena<br>
+2 winning rounds: 80,000 Adena<br>
+3 winning rounds: 110,000 Adena, D-grade Enchant Weapon Scroll<br>
+4 winning rounds: 199,000 Adena, C-grade Enchant Weapon Scroll<br>
+5 winning rounds: 388,000 Adena, 1 recipe for a B-grade Weapon<br>
+6 winning rounds: 675,000 Adena, 1 essential ingredient for a B-grade Weapon<br>
+7 winning rounds: 1,284,000 Adena, 2 B-grade Enchant Weapon Scrolls, 2 B-grade Enchant Armor Scrolls<br>
+8 winning rounds: 2,384,000 Adena, 1 A-grade Enchant Weapon Scroll, 2 A-grade Enchant Armor Scrolls<br>
+My advice is to identify what you'd like to win and then to play for that prize. Any questions?<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-06.htm">"What is a Spirit Bead?"</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-07.htm">"How do you play the game called War Between the Sun and the Moon?"</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-22.htm">"I want to practice." (Need 1 Spirit Bead.)</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-09.htm">"Let's play!" (Need 50 Spirit Beads.)</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-09.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-09.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-09.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Blacksmith Wilbert:<br>
+Well, then, ready to get started? I see you've already put in the 50 spirit beads you need to play. Excellent!<br>
+Whenever you're ready, my friend, draw your card.<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-14.htm">Draw a card.</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-28.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-28.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-28.htm	(revision 342)
@@ -0,0 +1,16 @@
+<html><body>Blacksmith Wilbert:<br>
+OK, now it's your turn. I drew: <font color="LEVEL">%card2pic%</font>. The cards on the table are:<br>
+<table border="0" border color="white" width="230" height="60">
+<tr>
+<td width="80" height="20" align="center">[Wilbert]</td>
+<td width="150" height="20" align="center">[ %name% ]</td>
+</tr>
+<tr>
+<td width="80" height="30" align="center">%card2pic%</td>
+<td width="150" height="30" align="center">%card1pic%</td>
+</tr>
+</table>
+<br><br>
+Go ahead and draw a card.<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-25.htm">Take out the card.</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-09a.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-09a.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-09a.htm	(revision 342)
@@ -0,0 +1,5 @@
+<html><body>Blacksmith Wilbert:<br>
+Are you ready to get started?<br>
+Draw your card.<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-14.htm">Draw a card.</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-29.htm
===================================================================
--- /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-29.htm	(revision 342)
+++ /trunk/aCis_datapack/data/scripts/quests/Q663_SeductiveWhispers/30846-29.htm	(revision 342)
@@ -0,0 +1,12 @@
+<html><body>Blacksmith Wilbert:<br>
+I drew <font color="LEVEL">%card2pic%</font>. The cards on the table are:<br>
+<table border="0" border color="white" width="230" height="60">
+<tr><td width="80" height="20" align="center">[Wilbert]</td><td width="150" height="20" align="center">[ %name% ]</td></tr>
+<tr><td width="80" height="30" align="center">%card2pic%</td><td width="150" height="30" align="center">%card1pic%</td></tr>
+</table>
+<br>
+What luck! Looks like I win. Still, it was a pretty exciting practice run, eh? If you want to play again, feel free to challenge me.<br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-22.htm">"I'd like to keep practicing."</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-09.htm">"I want to play the game now."</a><br>
+<a action="bypass -h Quest Q663_SeductiveWhispers 30846-31.htm">"I want to quit."</a>
+</body></html>
Index: /trunk/aCis_datapack/data/scripts/village_master/SecondClassChange/SecondClassChange.java
===================================================================
--- /trunk/aCis_datapack/data/scripts/village_master/SecondClassChange/SecondClassChange.java	(revision 341)
+++ /trunk/aCis_datapack/data/scripts/village_master/SecondClassChange/SecondClassChange.java	(revision 342)
@@ -849,13 +849,13 @@
 				change = "master_de";
 				break;
-				
+			
 			case Dwarf:
 				change = "master_dwarf";
 				break;
-				
+			
 			case Orc:
 				change = "master_orc";
 				break;
-				
+			
 			case Human:
 			case Elf:
